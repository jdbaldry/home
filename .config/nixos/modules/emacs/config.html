<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-03-21 Tue 14:00 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Literate Emacs configuration</title>
<meta name="author" content="Jack Baldry" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style>code {font-weight: bold}</style>
<style>.src {background-color: #111111; color: #ffffff}</style>
<style>.note {margin: 1.2em; border-left: 3px solid; padding: 6px 12px 6px 24px}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Literate Emacs configuration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0a7d0a9">1. Early init</a>
<ul>
<li><a href="#org08f6a51">1.1. Add header for linting</a></li>
<li><a href="#org6c4ac6c">1.2. Message the init time and number of garbage collections</a></li>
<li><a href="#orgdbeb84c">1.3. Test "best possible" startup time</a></li>
<li><a href="#org264e948">1.4. Make startup faster by reducing the frequency of garbage collection</a></li>
<li><a href="#org25e954b">1.5. Require use-package which is used to manage all other packages</a></li>
<li><a href="#org8811d56">1.6. Start the Emacs server</a></li>
<li><a href="#org1884c29">1.7. Unbind the jdb (Java debugger) function that interferes with my namespacing</a></li>
<li><a href="#orgb2c315c">1.8. Increase usable space and inhibit startup screen</a></li>
<li><a href="#org8876e63">1.9. Add footer for linting</a></li>
</ul>
</li>
<li><a href="#org537453f">2. Init</a>
<ul>
<li><a href="#orga695c8d">2.1. Add header for linting</a></li>
<li><a href="#org136f8a0">2.2. Set up custom variables group</a></li>
<li><a href="#org4e5c6d2">2.3. Set separate custom file</a></li>
<li><a href="#orgb111226">2.4. Move save files and avoid interlock files</a></li>
<li><a href="#org3dbe934">2.5. Clipboards and killing</a>
<ul>
<li><a href="#org6f645f8">2.5.1. Save existing clipboard text into kill ring before replacing it</a></li>
<li><a href="#orga298c5b">2.5.2. Clear the kill ring</a></li>
</ul>
</li>
<li><a href="#orgf129237">2.6. Configure appearance</a></li>
<li><a href="#orga7adf25">2.7. Set indentation defaults</a>
<ul>
<li><a href="#org49664f1">2.7.1. Set custom variable for single sourcing indentation width</a></li>
<li><a href="#org0a9a4dd">2.7.2. Default to spaces</a></li>
<li><a href="#org2bad783">2.7.3. Infer whether a file is using spaces or tabs</a></li>
<li><a href="#orgc1a264d">2.7.4. Set default tab display width and tab stop sequence</a></li>
<li><a href="#orgbf67954">2.7.5. Configure default width for SMIE indentation</a></li>
<li><a href="#orga4148bb">2.7.6. Set <code>sh-mode</code> basic offset</a></li>
<li><a href="#orgfc744b4">2.7.7. Set <code>js-json-mode</code> and <code>js-mode</code> basic offsets</a></li>
<li><a href="#orgf8deb3b">2.7.8. Stop electric-indent-mode interfering with the previous line</a></li>
</ul>
</li>
<li><a href="#orgeaefe86">2.8. Use envrc environment variables</a></li>
<li><a href="#org1dab625">2.9. Use Ivy, Swiper, and Counsel for more effective minibuffers</a></li>
<li><a href="#org8e2379a">2.10. Use company for better completions</a></li>
<li><a href="#org8179c66">2.11. Intercept shell-mode comint commands</a></li>
<li><a href="#org95ac1b2">2.12. xterm-color support</a></li>
<li><a href="#org4fa1a2a">2.13. Ligatures</a></li>
<li><a href="#org7b5dcb8">2.14. Highlight erroneous whitespace</a></li>
<li><a href="#org59e2e4f">2.15. Add extra information to dired listing</a></li>
<li><a href="#org8929d62">2.16. Enable multiple cursors</a></li>
<li><a href="#orgcc5b723">2.17. Expand region at point</a></li>
<li><a href="#org12d5b66">2.18. Development environments</a>
<ul>
<li><a href="#org6597cf3">2.18.1. Flycheck</a></li>
<li><a href="#orga18a5f6">2.18.2. LSP</a></li>
<li><a href="#org5baec5d">2.18.3. Agda</a></li>
<li><a href="#org5bfdc8d">2.18.4. Bash</a></li>
<li><a href="#orgc69b4ef">2.18.5. Emacs Lisp</a></li>
<li><a href="#orgf9c5e41">2.18.6. Go</a></li>
<li><a href="#org9d3e149">2.18.7. Haskell</a></li>
<li><a href="#orgcbf3761">2.18.8. JavaScript</a></li>
<li><a href="#org5d8d8d3">2.18.9. Jsonnet</a></li>
<li><a href="#org98bc33e">2.18.10. Markdown</a></li>
<li><a href="#orgd44c3fa">2.18.11. Nix</a></li>
<li><a href="#orgd082c4b">2.18.12. River</a></li>
<li><a href="#org5d9a313">2.18.13. Terraform</a></li>
</ul>
</li>
<li><a href="#orgc9b770e">2.19. Forges</a>
<ul>
<li><a href="#orgca0c293">2.19.1. GitHub</a></li>
</ul>
</li>
<li><a href="#orgff3f916">2.20. Automatically revert buffers if the file changes</a></li>
<li><a href="#org1a70b76">2.21. Use magit for git</a>
<ul>
<li><a href="#org33130b6">2.21.1. Use difftastic for diffing</a></li>
<li><a href="#org9f497f0">2.21.2. Add personal transients</a></li>
</ul>
</li>
<li><a href="#org8d2ddd6">2.22. Org export</a>
<ul>
<li><a href="#org42ae5a3">2.22.1. Enable syntax highlighting</a></li>
<li><a href="#org0f007e4">2.22.2. Enable Markdown export</a></li>
</ul>
</li>
<li><a href="#org736ade0">2.23. Task management</a>
<ul>
<li><a href="#org0b3685a">2.23.1. Utilities</a></li>
<li><a href="#org46f2871">2.23.2. Interact with Slack</a></li>
<li><a href="#org76e1852">2.23.3. Tests</a></li>
<li><a href="#org92a76f6">2.23.4. Interact with Google Calendar</a></li>
</ul>
</li>
<li><a href="#org80a2ff7">2.24. Use Projectile for working with multiple code projects</a></li>
<li><a href="#org000cb43">2.25. HTML</a></li>
<li><a href="#org2ec434b">2.26. Edit browser text fields within Emacs</a></li>
<li><a href="#orga4b8da1">2.27. Passwords</a>
<ul>
<li><a href="#org864c914">2.27.1. Start Pinentry service to have gpg commands interact with Emacs</a></li>
<li><a href="#org8f2e9dd">2.27.2. Configure the Unix password manager pass as an auth source</a></li>
</ul>
</li>
<li><a href="#orgec0e1eb">2.28. Email</a></li>
<li><a href="#orgb76d29e">2.29. Jump to a word</a></li>
<li><a href="#org752d36d">2.30. Capture a screenshot</a></li>
<li><a href="#org1d75893">2.31. Regular expressions for URLs</a></li>
<li><a href="#org3d14f7b">2.32. Conveniently browse to URLs</a></li>
<li><a href="#org8ecf40e">2.33. Manage brightness</a></li>
<li><a href="#org1664b15">2.34. Manage sound</a></li>
<li><a href="#orgeb9682d">2.35. Goto for compilation-mode errors</a></li>
<li><a href="#orgc2bf85f">2.36. Snippets with yasnippet</a></li>
<li><a href="#org699f092">2.37. Use rx in re-builder</a></li>
<li><a href="#org3fc105f">2.38. Format everything</a></li>
<li><a href="#org4471160">2.39. NixOS</a></li>
<li><a href="#org7699cb3">2.40. Git</a></li>
<li><a href="#orgb65133d">2.41. Speed up garbage collection</a></li>
<li><a href="#orgeb5108e">2.42. Miscellany</a>
<ul>
<li><a href="#org698d976">2.42.1. Convert a string to Slack alphabet emojis.</a></li>
<li><a href="#org5d9c4dc">2.42.2. Apply an RCS formatted patch to a buffer</a></li>
<li><a href="#orgb1886c1">2.42.3. Implement watch buffer</a></li>
<li><a href="#org00e1b0a">2.42.4. Caps lock minor mode</a></li>
<li><a href="#org970a51f">2.42.5. Zap up to char</a></li>
<li><a href="#org3a07080">2.42.6. Transpose lines</a></li>
</ul>
</li>
<li><a href="#org92b2205">2.43. Legacy EXWM code</a></li>
<li><a href="#org1f64042">2.44. Add footer for linting</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
Useful reminders for working in this file:
</p>
<ul class="org-ul">
<li>Add footnotes with <code>C-c C-x f</code><sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup></li>
<li>Export the file with <code>C-c C-e</code></li>
<li>Add a structure with <code>C-c C-,</code></li>
<li>Tangle org file with <code>C-c C-v t</code></li>
<li>Format buffer with <code>C-x h C-M-\ C-u C-SPC C-u C-SPC</code></li>
<li>Add a source code block tangled into <code>~/.emacs.d/init.el</code> with yasnippet key <code>init.el</code></li>
<li>Add a note with yasnippet key <code>note</code></li>
</ul>

<div id="outline-container-org0a7d0a9" class="outline-2">
<h2 id="org0a7d0a9"><span class="section-number-2">1.</span> Early init</h2>
<div class="outline-text-2" id="text-1">
<p>
Executed before the startup of the GUI.
</p>
</div>

<div id="outline-container-org08f6a51" class="outline-3">
<h3 id="org08f6a51"><span class="section-number-3">1.1.</span> Add header for linting</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;;; </span><span style="color: #989898;">early-init.el --- Early init file</span>

<span style="color: #989898;">;;; </span><span style="color: #989898;">Commentary:</span>
<span style="color: #989898;">;;; </span><span style="color: #989898;">This file is managed in a literate org file ~/ext/.config/nixos/modules/emacs/config.org</span>
<span style="color: #989898;">;;; </span><span style="color: #989898;">Code:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c4ac6c" class="outline-3">
<h3 id="org6c4ac6c"><span class="section-number-3">1.2.</span> Message the init time and number of garbage collections</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-startup-hook
          (<span style="color: #b6a0ff;">lambda</span> ()
            (message <span style="color: #79a8ff;">"Emacs ready in %s with %d garbage collections."</span>
                     (format <span style="color: #79a8ff;">"%.2f seconds"</span>
                             (float-time (time-subtract after-init-time before-init-time)))
                     gcs-done)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbeb84c" class="outline-3">
<h3 id="orgdbeb84c"><span class="section-number-3">1.3.</span> Test "best possible" startup time<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup></h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-shell">emacs -q --eval=<span style="color: #79a8ff;">'(message "%s" (emacs-init-time))'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org264e948" class="outline-3">
<h3 id="org264e948"><span class="section-number-3">1.4.</span> Make startup faster by reducing the frequency of garbage collection</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The default is 800 kilobytes.
Measured in bytes.
</p>

<p>
In the init, this is tuned back down to speed up garbage collections during runtime.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> gc-cons-threshold (* 50 1000 1000))
</pre>
</div>
</div>
</div>

<div id="outline-container-org25e954b" class="outline-3">
<h3 id="org25e954b"><span class="section-number-3">1.5.</span> Require use-package which is used to manage all other packages</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">eval-when-compile</span>
  (<span style="color: #b6a0ff;">require</span> '<span style="color: #00bcff;">package</span>)
  (add-to-list 'package-archives
               '(<span style="color: #79a8ff;">"MELPA"</span> . <span style="color: #79a8ff;">"http://melpa.org/packages/"</span>))
  (<span style="color: #b6a0ff;">require</span> '<span style="color: #00bcff;">use-package</span>)
  (<span style="color: #b6a0ff;">setq</span> use-package-expand-minimally byte-compile-current-file))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8811d56" class="outline-3">
<h3 id="org8811d56"><span class="section-number-3">1.6.</span> Start the Emacs server</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(server-start)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1884c29" class="outline-3">
<h3 id="org1884c29"><span class="section-number-3">1.7.</span> Unbind the jdb (Java debugger) function that interferes with my namespacing</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(fmakunbound 'jdb)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2c315c" class="outline-3">
<h3 id="orgb2c315c"><span class="section-number-3">1.8.</span> Increase usable space and inhibit startup screen</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> inhibit-startup-screen t)

<span style="color: #989898;">;; </span><span style="color: #989898;">Disable menu, tool, and scroll bars.</span>
(menu-bar-mode 0)
(tool-bar-mode 0)
(scroll-bar-mode 0)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8876e63" class="outline-3">
<h3 id="org8876e63"><span class="section-number-3">1.9.</span> Add footer for linting</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;;; </span><span style="color: #989898;">early-init.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org537453f" class="outline-2">
<h2 id="org537453f"><span class="section-number-2">2.</span> Init</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orga695c8d" class="outline-3">
<h3 id="orga695c8d"><span class="section-number-3">2.1.</span> Add header for linting</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;;; </span><span style="color: #989898;">init.el --- Init file</span>

<span style="color: #989898;">;;; </span><span style="color: #989898;">Commentary:</span>
<span style="color: #989898;">;;; </span><span style="color: #989898;">This file is managed in a literate org file ~/ext/.config/nixos/modules/emacs/config.org</span>
<span style="color: #989898;">;;; </span><span style="color: #989898;">Code:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org136f8a0" class="outline-3">
<h3 id="org136f8a0"><span class="section-number-3">2.2.</span> Set up custom variables group</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defgroup</span> <span style="color: #6ae4b9;">jdb</span> nil <span style="color: #9ac8e0;">"Personal group."</span>
  <span style="color: #f78fe7;">:group</span> 'emacs
  <span style="color: #f78fe7;">:version</span> <span style="color: #79a8ff;">"27"</span>
  <span style="color: #f78fe7;">:prefix</span> <span style="color: #79a8ff;">"jdb/"</span>)

(<span style="color: #b6a0ff;">defcustom</span> <span style="color: #00d3d0;">jdb/slack-status--collection</span> nil
  <span style="color: #9ac8e0;">"Collection of emoji strings useful in Slack statuses."</span>
  <span style="color: #f78fe7;">:group</span> 'jdb
  <span style="color: #f78fe7;">:type</span> '(repeat string))

(<span style="color: #b6a0ff;">defcustom</span> <span style="color: #00d3d0;">jdb/co-authored-by--collection</span> nil
  <span style="color: #9ac8e0;">"Collection of author strings."</span>
  <span style="color: #f78fe7;">:group</span> 'jdb
  <span style="color: #f78fe7;">:type</span> '(repeat string))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e5c6d2" class="outline-3">
<h3 id="org4e5c6d2"><span class="section-number-3">2.3.</span> Set separate custom file</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> custom-file <span style="color: #79a8ff;">"~/.emacs.d/custom.el"</span>)
(load custom-file)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb111226" class="outline-3">
<h3 id="orgb111226"><span class="section-number-3">2.4.</span> Move save files and avoid interlock files</h3>
<div class="outline-text-3" id="text-2-4">
<p>
As a single user, interlocks aren't very useful.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> backup-directory-alist '((<span style="color: #79a8ff;">"."</span> . <span style="color: #79a8ff;">"~/.emacs_saves"</span>)))
(<span style="color: #b6a0ff;">setq</span> auto-save-file-name-transforms '((<span style="color: #79a8ff;">".*"</span> <span style="color: #79a8ff;">"~/.emacs_saves/"</span> t)))
(<span style="color: #b6a0ff;">setq</span> create-lockfiles nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3dbe934" class="outline-3">
<h3 id="org3dbe934"><span class="section-number-3">2.5.</span> Clipboards and killing</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-org6f645f8" class="outline-4">
<h4 id="org6f645f8"><span class="section-number-4">2.5.1.</span> Save existing clipboard text into kill ring before replacing it</h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> save-interprogram-paste-before-kill t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga298c5b" class="outline-4">
<h4 id="orga298c5b"><span class="section-number-4">2.5.2.</span> Clear the kill ring</h4>
<div class="outline-text-4" id="text-2-5-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/clear-kill-ring</span> ()
  <span style="color: #9ac8e0;">"Clear the '</span><span style="color: #00bcff;">kill-ring</span><span style="color: #9ac8e0;">'."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">setq</span> kill-ring nil))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf129237" class="outline-3">
<h3 id="orgf129237"><span class="section-number-3">2.6.</span> Configure appearance</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(load-theme 'modus-vivendi t)

<span style="color: #989898;">;; </span><span style="color: #989898;">Increase font size.</span>
(set-face-attribute 'default nil <span style="color: #f78fe7;">:height</span> 140)
(set-face-attribute 'mode-line nil <span style="color: #f78fe7;">:height</span> 100)

<span style="color: #989898;">;; </span><span style="color: #989898;">Enable globally set relative line numbers.</span>
(global-display-line-numbers-mode)
(<span style="color: #b6a0ff;">setq</span> display-line-numbers-type 'relative)

<span style="color: #989898;">;; </span><span style="color: #989898;">Display keypresses.</span>
(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">keycast</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:init</span>
  (keycast-mode)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> keycast-mode-line-remove-tail-elements nil)
  <span style="color: #f78fe7;">:defer</span> t)

<span style="color: #989898;">;; </span><span style="color: #989898;">Highlight the current line globally.</span>
(global-hl-line-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7adf25" class="outline-3">
<h3 id="orga7adf25"><span class="section-number-3">2.7.</span> Set indentation defaults</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-org49664f1" class="outline-4">
<h4 id="org49664f1"><span class="section-number-4">2.7.1.</span> Set custom variable for single sourcing indentation width</h4>
<div class="outline-text-4" id="text-2-7-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defcustom</span> <span style="color: #00d3d0;">jdb/indent-width</span> 2
  <span style="color: #9ac8e0;">"Set default indent width."</span>
  <span style="color: #f78fe7;">:group</span> 'jdb
  <span style="color: #f78fe7;">:type</span> 'string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a9a4dd" class="outline-4">
<h4 id="org0a9a4dd"><span class="section-number-4">2.7.2.</span> Default to spaces</h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> indent-tabs-mode nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-org2bad783" class="outline-4">
<h4 id="org2bad783"><span class="section-number-4">2.7.3.</span> Infer whether a file is using spaces or tabs</h4>
<div class="outline-text-4" id="text-2-7-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">infer-indentation-style</span> ()
  <span style="color: #9ac8e0;">"Infer whether a file is indented with spaces or tabs."</span>
  (<span style="color: #b6a0ff;">let</span> ((spaces (how-many <span style="color: #79a8ff;">"^  "</span> (point-min) (point-max)))
        (tabs (how-many <span style="color: #79a8ff;">"^\t"</span> (point-min) (point-max))))
    (<span style="color: #b6a0ff;">if</span> (&gt; spaces tabs) (<span style="color: #b6a0ff;">setq</span> indent-tabs-mode nil))
    (<span style="color: #b6a0ff;">if</span> (&gt; tabs spaces) (<span style="color: #b6a0ff;">setq</span> indent-tabs-mode t))))
(add-hook 'prog-mode-hook 'infer-indentation-style)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1a264d" class="outline-4">
<h4 id="orgc1a264d"><span class="section-number-4">2.7.4.</span> Set default tab display width and tab stop sequence</h4>
<div class="outline-text-4" id="text-2-7-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> tab-width jdb/indent-width)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf67954" class="outline-4">
<h4 id="orgbf67954"><span class="section-number-4">2.7.5.</span> Configure default width for SMIE indentation</h4>
<div class="outline-text-4" id="text-2-7-5">
<p>
Most modes that indent using SMIE rules will have their own <code>&lt;MODE&gt;-basic-offset</code> custom varaible.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> smie-indent-basic jdb/indent-width)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4148bb" class="outline-4">
<h4 id="orga4148bb"><span class="section-number-4">2.7.6.</span> Set <code>sh-mode</code> basic offset</h4>
<div class="outline-text-4" id="text-2-7-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> sh-basic-offset jdb/indent-width)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc744b4" class="outline-4">
<h4 id="orgfc744b4"><span class="section-number-4">2.7.7.</span> Set <code>js-json-mode</code> and <code>js-mode</code> basic offsets</h4>
<div class="outline-text-4" id="text-2-7-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> js-indent-level jdb/indent-width)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8deb3b" class="outline-4">
<h4 id="orgf8deb3b"><span class="section-number-4">2.7.8.</span> Stop electric-indent-mode interfering with the previous line</h4>
<div class="outline-text-4" id="text-2-7-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> electric-indent-mode t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeaefe86" class="outline-3">
<h3 id="orgeaefe86"><span class="section-number-3">2.8.</span> Use envrc environment variables</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">direnv</span> <span style="color: #f78fe7;">:ensure</span> t <span style="color: #f78fe7;">:init</span> (direnv-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1dab625" class="outline-3">
<h3 id="org1dab625"><span class="section-number-3">2.9.</span> Use Ivy, Swiper, and Counsel for more effective minibuffers</h3>
<div class="outline-text-3" id="text-2-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">ivy</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:init</span> (ivy-mode)
  <span style="color: #f78fe7;">:commands</span> (ivy-mode)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> ivy-display-style 'fancy)
  (<span style="color: #b6a0ff;">setq</span> ivy-use-virtual-buffers t)
  (<span style="color: #b6a0ff;">setq</span> ivy-use-selectable-prompt t)
  (<span style="color: #b6a0ff;">setq</span> enable-recursive-minibuffers t)
  (<span style="color: #b6a0ff;">setq</span> search-default-mode #'char-fold-to-regexp))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">swiper</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:after</span> ivy
  <span style="color: #f78fe7;">:bind</span> ((<span style="color: #79a8ff;">"C-s"</span> . swiper)))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">counsel</span> <span style="color: #f78fe7;">:init</span> (counsel-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e2379a" class="outline-3">
<h3 id="org8e2379a"><span class="section-number-3">2.10.</span> Use company for better completions</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">company</span> <span style="color: #f78fe7;">:ensure</span> t <span style="color: #f78fe7;">:init</span> (global-company-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8179c66" class="outline-3">
<h3 id="org8179c66"><span class="section-number-3">2.11.</span> Intercept shell-mode comint commands</h3>
<div class="outline-text-3" id="text-2-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">shell-comint-send-input</span> ()
  <span style="color: #9ac8e0;">"Interfere with '</span><span style="color: #00bcff;">comint-send-input</span><span style="color: #9ac8e0;">' to facilitate redirect to a buffer."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((line (buffer-substring (line-beginning-position) (line-end-position))))
    (<span style="color: #b6a0ff;">cond</span> ((string-match (<span style="color: #b6a0ff;">rx</span> <span style="color: #79a8ff;">"(compile "</span> (group (* (not <span style="color: #79a8ff;">")"</span>))) <span style="color: #79a8ff;">")"</span>) line)
           (<span style="color: #b6a0ff;">let</span> ((compilation-buffer-name-function (<span style="color: #b6a0ff;">lambda</span> (_) line)))
             (direnv-update-environment)
             (comint-add-to-input-history line)
             (compile (match-string 1 line))))
          ((string-match (<span style="color: #b6a0ff;">rx</span> (* <span style="color: #79a8ff;">" "</span>) (group (*? any)) (? <span style="color: #79a8ff;">" "</span>) <span style="color: #79a8ff;">"&gt;&gt;&gt;"</span> (? <span style="color: #79a8ff;">" "</span>) <span style="color: #79a8ff;">"#&lt;"</span> (group (* (not <span style="color: #79a8ff;">"&gt;"</span>))) <span style="color: #79a8ff;">"&gt;"</span>) line)
           (<span style="color: #b6a0ff;">let</span> ((compilation-buffer-name-function (<span style="color: #b6a0ff;">lambda</span> (_) (match-string 2 line))))
             (direnv-update-environment)
             (comint-add-to-input-history line)
             (compile (match-string 1 line))))
          (t (comint-send-input)))))

(add-hook 'shell-mode-hook (<span style="color: #b6a0ff;">lambda</span> () (local-set-key (kbd <span style="color: #79a8ff;">"RET"</span>)  'shell-comint-send-input)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org95ac1b2" class="outline-3">
<h3 id="org95ac1b2"><span class="section-number-3">2.12.</span> xterm-color support</h3>
<div class="outline-text-3" id="text-2-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">xterm-color</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:config</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">xterm-color for shell mode.</span>
  (add-hook 'shell-mode-hook
            (<span style="color: #b6a0ff;">lambda</span> ()
              <span style="color: #989898;">;; </span><span style="color: #989898;">Disable font-locking in this buffer to improve performance</span>
              (font-lock-mode -1)
              <span style="color: #989898;">;; </span><span style="color: #989898;">Prevent font-locking from being re-enabled in this buffer</span>
              (make-local-variable 'font-lock-function)
              (<span style="color: #b6a0ff;">setq</span> font-lock-function (<span style="color: #b6a0ff;">lambda</span> (_) nil))
              (add-hook 'comint-preoutput-filter-functions 'xterm-color-filter nil t)))

  <span style="color: #989898;">;; </span><span style="color: #989898;">xterm-color for compilation-shell-minor-mode (used by comint).</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">TODO: Find alternative solution as this is not recommended by xterm-color due to font-lock</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">performance degradation.</span>
  (add-hook 'compilation-shell-minor-mode-hook
            (<span style="color: #b6a0ff;">lambda</span> () (add-hook 'comint-preoutput-filter-functions 'xterm-color-filter nil t)))

  <span style="color: #989898;">;; </span><span style="color: #989898;">xterm-color for compilation-mode.</span>
  (<span style="color: #b6a0ff;">setq</span> compilation-environment '(<span style="color: #79a8ff;">"TERM=xterm-256color"</span>))
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/advice-compilation-filter</span> (f proc string)
    (funcall f proc (xterm-color-filter string)))
  (advice-add 'compilation-filter <span style="color: #f78fe7;">:around</span> #'jdb/advice-compilation-filter)

  <span style="color: #989898;">;; </span><span style="color: #989898;">xterm-color for ripgrep.</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">From https://github.com/dajva/rg.el/issues/65.</span>
  (<span style="color: #b6a0ff;">define-advice</span> <span style="color: #feacd0;">rg-run</span> (<span style="color: #f78fe7;">:around</span> (orig-fn <span style="color: #6ae4b9;">&amp;rest</span> args) <span style="color: #79a8ff;">"no-xterm-color"</span>)
    (<span style="color: #b6a0ff;">let</span> ((compilation-start-hook
           (remove 'my-compilation-start-hook compilation-start-hook))
          compilation-environment)
      (apply orig-fn args)))

  (<span style="color: #b6a0ff;">setq</span> comint-output-filter-functions
        (remove 'ansi-color-process-output comint-output-filter-functions)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fa1a2a" class="outline-3">
<h3 id="org4fa1a2a"><span class="section-number-3">2.13.</span> Ligatures</h3>
<div class="outline-text-3" id="text-2-13">
<p>
From <a href="https://github.com/mickeynp/ligature.el/wiki#cascadia--fira-code">https://github.com/mickeynp/ligature.el/wiki#cascadia--fira-code</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">ligature</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:config</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">Enable all Cascadia and Fira Code ligatures in programming modes.</span>
  (ligature-set-ligatures
   'prog-mode
   '(<span style="color: #989898;">;; </span><span style="color: #989898;">== === ==== =&gt; =| =&gt;&gt;=&gt;=|=&gt;==&gt;&gt; ==&lt; =/=//=// =~</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">=:= =!=</span>
     (<span style="color: #79a8ff;">"="</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">"~"</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"!"</span> <span style="color: #79a8ff;">"="</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">;; ;;;</span>
     (<span style="color: #79a8ff;">";"</span> (<span style="color: #b6a0ff;">rx</span> (+ <span style="color: #79a8ff;">";"</span>)))
     <span style="color: #989898;">;; </span><span style="color: #989898;">&amp;&amp; &amp;&amp;&amp;</span>
     (<span style="color: #79a8ff;">"&amp;"</span> (<span style="color: #b6a0ff;">rx</span> (+ <span style="color: #79a8ff;">"&amp;"</span>)))
     <span style="color: #989898;">;; </span><span style="color: #989898;">!! !!! !. !: !!. != !== !~</span>
     (<span style="color: #79a8ff;">"!"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"!"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">."</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"~"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">?? ??? ?:  ?=  ?.</span>
     (<span style="color: #79a8ff;">"?"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">."</span> (+ <span style="color: #79a8ff;">"?"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">%% %%%</span>
     (<span style="color: #79a8ff;">"%"</span> (<span style="color: #b6a0ff;">rx</span> (+ <span style="color: #79a8ff;">"%"</span>)))
     <span style="color: #989898;">;; </span><span style="color: #989898;">|&gt; ||&gt; |||&gt; ||||&gt; |] |} || ||| |-&gt; ||-||</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">|-&gt;&gt;-||-&lt;&lt;-| |- |== ||=||</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">|==&gt;&gt;==&lt;&lt;==&lt;=&gt;==//==/=!==:===&gt;</span>
     (<span style="color: #79a8ff;">"|"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"!"</span> <span style="color: #79a8ff;">"}"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">]"</span>
                     <span style="color: #79a8ff;">"-"</span> <span style="color: #79a8ff;">"="</span> ))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">\\ \\\ \/</span>
     (<span style="color: #79a8ff;">"\\"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"/"</span> (+ <span style="color: #79a8ff;">"\\"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">++ +++ ++++ +&gt;</span>
     (<span style="color: #79a8ff;">"+"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> (+ <span style="color: #79a8ff;">"+"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">:: ::: :::: :&gt; :&lt; := :// ::=</span>
     (<span style="color: #79a8ff;">":"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"//"</span> <span style="color: #79a8ff;">":="</span> (+ <span style="color: #79a8ff;">":"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">// /// //// /\ /* /&gt; /===:===!=//===&gt;&gt;==&gt;==/</span>
     (<span style="color: #79a8ff;">"/"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span>  <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">"\\"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">*"</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"!"</span>
                     <span style="color: #79a8ff;">"="</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">.. ... .... .= .- .? ..= ..&lt;</span>
     (<span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">."</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"-"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">?"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">.="</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">.&lt;"</span> (+ <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">."</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">-- --- ---- -~ -&gt; -&gt;&gt; -| -|-&gt;--&gt;&gt;-&gt;--&lt;&lt;-|</span>
     (<span style="color: #79a8ff;">"-"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"~"</span> <span style="color: #79a8ff;">"-"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">*&gt; */ *)  ** *** ****</span>
     (<span style="color: #79a8ff;">"*"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">")"</span> (+ <span style="color: #79a8ff;">"*"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">www wwww</span>
     (<span style="color: #79a8ff;">"w"</span> (<span style="color: #b6a0ff;">rx</span> (+ <span style="color: #79a8ff;">"w"</span>)))
     <span style="color: #989898;">;; </span><span style="color: #989898;">&lt;&gt; &lt;!-- &lt;|&gt; &lt;: &lt;~ &lt;~&gt; &lt;~~ &lt;+ &lt;* &lt;$ &lt;/  &lt;+&gt; &lt;*&gt;</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">&lt;$&gt; &lt;/&gt; &lt;|  &lt;||  &lt;||| &lt;|||| &lt;- &lt;-| &lt;-&lt;&lt;-|-&gt; &lt;-&gt;&gt;</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">&lt;&lt;-&gt; &lt;= &lt;=&gt; &lt;&lt;==&lt;&lt;==&gt;=|=&gt;==/==//=!==:=&gt;</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">&lt;&lt; &lt;&lt;&lt; &lt;&lt;&lt;&lt;</span>
     (<span style="color: #79a8ff;">"&lt;"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">+"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">*"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">$"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"~"</span>  <span style="color: #79a8ff;">"!"</span>
                     <span style="color: #79a8ff;">"-"</span>  <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"="</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">&gt;: &gt;- &gt;&gt;- &gt;--|-&gt; &gt;&gt;-|-&gt; &gt;= &gt;== &gt;&gt;== &gt;=|=:=&gt;&gt;</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;&gt;</span>
     (<span style="color: #79a8ff;">"&gt;"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"&lt;"</span> <span style="color: #79a8ff;">"|"</span> <span style="color: #79a8ff;">"/"</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"-"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">#: #= #! #( #? #[ #{ #_ #_( ## ### #####</span>
     (<span style="color: #79a8ff;">"#"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">":"</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"!"</span> <span style="color: #79a8ff;">"("</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">?"</span> <span style="color: #79a8ff;">"</span><span style="color: #fec43f;">\</span><span style="color: #79a8ff;">["</span> <span style="color: #79a8ff;">"{"</span> <span style="color: #79a8ff;">"_("</span> <span style="color: #79a8ff;">"_"</span>
                  (+ <span style="color: #79a8ff;">"#"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">~~ ~~~ ~=  ~-  ~@ ~&gt; ~~&gt;</span>
     (<span style="color: #79a8ff;">"~"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"&gt;"</span> <span style="color: #79a8ff;">"="</span> <span style="color: #79a8ff;">"-"</span> <span style="color: #79a8ff;">"@"</span> <span style="color: #79a8ff;">"~&gt;"</span> (+ <span style="color: #79a8ff;">"~"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">__ ___ ____ _|_ __|____|_</span>
     (<span style="color: #79a8ff;">"_"</span> (<span style="color: #b6a0ff;">rx</span> (+ (<span style="color: #b6a0ff;">or</span> <span style="color: #79a8ff;">"_"</span> <span style="color: #79a8ff;">"|"</span>))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">Fira code: 0xFF 0x12</span>
     (<span style="color: #79a8ff;">"0"</span> (<span style="color: #b6a0ff;">rx</span> (<span style="color: #b6a0ff;">and</span> <span style="color: #79a8ff;">"x"</span> (+ (in <span style="color: #79a8ff;">"A-F"</span> <span style="color: #79a8ff;">"a-f"</span> <span style="color: #79a8ff;">"0-9"</span>)))))
     <span style="color: #989898;">;; </span><span style="color: #989898;">Fira code:</span>
     <span style="color: #79a8ff;">"Fl"</span>  <span style="color: #79a8ff;">"Tl"</span>  <span style="color: #79a8ff;">"fi"</span>  <span style="color: #79a8ff;">"fj"</span>  <span style="color: #79a8ff;">"fl"</span>  <span style="color: #79a8ff;">"ft"</span>
     <span style="color: #989898;">;; </span><span style="color: #989898;">The few not covered by the regexps.</span>
     <span style="color: #79a8ff;">"{|"</span>  <span style="color: #79a8ff;">"[|"</span>  <span style="color: #79a8ff;">"]#"</span>  <span style="color: #79a8ff;">"(*"</span>  <span style="color: #79a8ff;">"}#"</span>  <span style="color: #79a8ff;">"$&gt;"</span>  <span style="color: #79a8ff;">"^="</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b5dcb8" class="outline-3">
<h3 id="org7b5dcb8"><span class="section-number-3">2.14.</span> Highlight erroneous whitespace</h3>
<div class="outline-text-3" id="text-2-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">whitespace</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:init</span>
  (global-whitespace-mode 1)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq-default</span> whitespace-line-column 160)
  (<span style="color: #b6a0ff;">setq-default</span> whitespace-style '(face trailing tabs lines lines-tail newline indentation space-after-tab empty space-before-tab tab-mark newline-mark))
  <span style="color: #989898;">;; </span><span style="color: #989898;">From: https://emacs.stackexchange.com/questions/38771/magit-status-does-not-open-when-using-global-whitespace-mode-1/38779.</span>
  (<span style="color: #b6a0ff;">add-function</span> <span style="color: #f78fe7;">:before-while</span> whitespace-enable-predicate
                (<span style="color: #b6a0ff;">lambda</span> ()
                  (not (derived-mode-p #'magit-mode #'shell-mode)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org59e2e4f" class="outline-3">
<h3 id="org59e2e4f"><span class="section-number-3">2.15.</span> Add extra information to dired listing</h3>
<div class="outline-text-3" id="text-2-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">dired</span> <span style="color: #f78fe7;">:config</span>   (<span style="color: #b6a0ff;">setq</span> dired-listing-switches <span style="color: #79a8ff;">"-alh"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8929d62" class="outline-3">
<h3 id="org8929d62"><span class="section-number-3">2.16.</span> Enable multiple cursors</h3>
<div class="outline-text-3" id="text-2-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">multiple-cursors</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:bind</span>
  ((<span style="color: #79a8ff;">"C-&gt;"</span> . mc/mark-next-like-this)
   (<span style="color: #79a8ff;">"C-&lt;"</span> . mc/mark-previous-like-this)
   (<span style="color: #79a8ff;">"C-c C-&lt;"</span> . mc/mark-all-like-this)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc5b723" class="outline-3">
<h3 id="orgcc5b723"><span class="section-number-3">2.17.</span> Expand region at point</h3>
<div class="outline-text-3" id="text-2-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">expand-region</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:bind</span>
  ((<span style="color: #79a8ff;">"C-."</span> . er/expand-region)
   (<span style="color: #79a8ff;">"C-,"</span> . er/contract-region)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org12d5b66" class="outline-3">
<h3 id="org12d5b66"><span class="section-number-3">2.18.</span> Development environments</h3>
<div class="outline-text-3" id="text-2-18">
</div>
<div id="outline-container-org6597cf3" class="outline-4">
<h4 id="org6597cf3"><span class="section-number-4">2.18.1.</span> Flycheck</h4>
<div class="outline-text-4" id="text-2-18-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">flycheck</span>
  <span style="color: #f78fe7;">:config</span>
  (global-flycheck-mode 1)
  <span style="color: #989898;">;; </span><span style="color: #989898;">Set flycheck to inherit the Emacs load path configured by Nix.</span>
  (<span style="color: #b6a0ff;">setq</span> flycheck-emacs-lisp-load-path 'inherit))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">flycheck-golangci-lint</span>
  <span style="color: #f78fe7;">:hook</span> (go-mode . flycheck-golangci-lint-setup)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defvar-local</span> <span style="color: #00d3d0;">flycheck-local-checkers</span> nil)
  (<span style="color: #b6a0ff;">setq</span> flycheck-golangci-lint-enable-all t)
  (<span style="color: #b6a0ff;">setq</span> flycheck-golangci-lint-disable-linters '(<span style="color: #79a8ff;">"lll"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga18a5f6" class="outline-4">
<h4 id="orga18a5f6"><span class="section-number-4">2.18.2.</span> LSP</h4>
<div class="outline-text-4" id="text-2-18-2">
<p>
Useful configuration for Go is documented in <a href="https://github.com/golang/tools/blob/master/gopls/doc/emacs.md">https://github.com/golang/tools/blob/master/gopls/doc/emacs.md</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">eglot</span>
  <span style="color: #f78fe7;">:after</span> company project yasnippet
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">project</span>)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">project-find-go-module</span> (dir)
    (<span style="color: #b6a0ff;">when-let</span> ((root (locate-dominating-file dir <span style="color: #79a8ff;">"go.mod"</span>)))
      (cons 'go-module root)))

  (<span style="color: #b6a0ff;">cl-defmethod</span> <span style="color: #feacd0;">project-root</span> ((project (head go-module)))
    (cdr project))

  (add-hook 'project-find-functions #'project-find-go-module)

  (<span style="color: #b6a0ff;">setq-default</span> eglot-workspace-configuration
                '((<span style="color: #f78fe7;">:gopls</span> . ((gofumpt . t)))))
  <span style="color: #989898;">;; </span><span style="color: #989898;">The depth of -10 places this before eglot's willSave notification,</span>
  <span style="color: #989898;">;; </span><span style="color: #989898;">so that that notification reports the actual contents that will be saved.</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">eglot-format-buffer-on-save</span> ()
    (add-hook 'before-save-hook #'eglot-format-buffer -10 t))
  (add-hook 'go-mode-hook #'eglot-format-buffer-on-save)
  <span style="color: #f78fe7;">:hook</span>
  (nix-mode . eglot-ensure)
  (go-mode . eglot-ensure))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5baec5d" class="outline-4">
<h4 id="org5baec5d"><span class="section-number-4">2.18.3.</span> Agda</h4>
<div class="outline-text-4" id="text-2-18-3">
<aside>
<div class="note" id="org8e44beb">
<p>
<b><b>NOTE:</b></b> This is not currently in use.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">agda2-mode</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5bfdc8d" class="outline-4">
<h4 id="org5bfdc8d"><span class="section-number-4">2.18.4.</span> Bash</h4>
<div class="outline-text-4" id="text-2-18-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">flymake</span> <span style="color: #f78fe7;">:hook</span> (sh-mode flymake-shellcheck-load))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc69b4ef" class="outline-4">
<h4 id="orgc69b4ef"><span class="section-number-4">2.18.5.</span> Emacs Lisp</h4>
<div class="outline-text-4" id="text-2-18-5">
<p>
Display debugger stack frames as a list.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> debugger-stack-frame-as-list t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9c5e41" class="outline-4">
<h4 id="orgf9c5e41"><span class="section-number-4">2.18.6.</span> Go</h4>
<div class="outline-text-4" id="text-2-18-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">go-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:mode</span> <span style="color: #79a8ff;">"\\.go\\'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d3e149" class="outline-4">
<h4 id="org9d3e149"><span class="section-number-4">2.18.7.</span> Haskell</h4>
<div class="outline-text-4" id="text-2-18-7">
<aside>
<div class="note" id="org8a3f2c3">
<p>
<b><b>NOTE:</b></b> This is not currently in use.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">haskell-mode</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbf3761" class="outline-4">
<h4 id="orgcbf3761"><span class="section-number-4">2.18.8.</span> JavaScript</h4>
<div class="outline-text-4" id="text-2-18-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">js2-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:mode</span>
  ((<span style="color: #79a8ff;">"\\.js\\'"</span> . js2-mode)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">typescript-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:mode</span> <span style="color: #79a8ff;">"\\.ts\\'"</span>
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> typescript-indent-level 2))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d8d8d3" class="outline-4">
<h4 id="org5d8d8d3"><span class="section-number-4">2.18.9.</span> Jsonnet</h4>
<div class="outline-text-4" id="text-2-18-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">jsonnet-mode</span>
  <span style="color: #f78fe7;">:hook</span> (jsonnet-mode . prettify-jsonnet)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">prettify-jsonnet</span>()
    <span style="color: #9ac8e0;">"Display some jsonnet keywords as pretty Unicode symbols."</span>
    (<span style="color: #b6a0ff;">setq</span> prettify-symbols-alist
          '((<span style="color: #79a8ff;">"function"</span> . ?&#955;)
            (<span style="color: #79a8ff;">"std."</span> . ?&#8203;) <span style="color: #989898;">;; </span><span style="color: #989898;">Note this is a zero width space.</span>
            (<span style="color: #79a8ff;">": { "</span> . ?.))))
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/docs-jsonnet-stdlib</span> ()
    <span style="color: #9ac8e0;">"Open the Jsonnet stdlib documentation."</span>
    (<span style="color: #b6a0ff;">interactive</span>)
    (browse-url <span style="color: #79a8ff;">"https://jsonnet.org/ref/stdlib.html"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98bc33e" class="outline-4">
<h4 id="org98bc33e"><span class="section-number-4">2.18.10.</span> Markdown</h4>
<div class="outline-text-4" id="text-2-18-10">
</div>
<ol class="org-ol">
<li><a id="orgee26b17"></a>Follow relref targets<br />
<div class="outline-text-5" id="text-2-18-10-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">markdown-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">markdown-relref-translate</span> (filename)
    <span style="color: #9ac8e0;">"Translate FILENAME into a link that can be followed.</span>
<span style="color: #9ac8e0;">Specifically, translating Hugo relrefs into filenames."</span>
    (replace-regexp-in-string <span style="color: #79a8ff;">"</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(?:</span><span style="color: #79a8ff;">{{&lt; relref \"</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">"</span> <span style="color: #79a8ff;">""</span> filename))
  (<span style="color: #b6a0ff;">setq</span> markdown-translate-filename-function 'markdown-relref-translate)
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/markdown-heading-id</span> (heading)
    <span style="color: #9ac8e0;">"Tranform HEADING into the GitHub identifier that an be used as an anchor."</span>
    (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sHeading: \n"</span>)
    (message (mapconcat (<span style="color: #b6a0ff;">lambda</span> (char)
                          (<span style="color: #b6a0ff;">cond</span>
                           ((<span style="color: #b6a0ff;">or</span> (char-equal char ?-) (char-equal char ? ))                          <span style="color: #79a8ff;">"-"</span>)
                           ((memq (get-char-code-property char 'general-category) '(Ll Lu Lo Lt Lm Mn Mc Me Nl))
                            (char-to-string (downcase char)))
                           (t <span style="color: #79a8ff;">""</span>)))
                        heading))))
</pre>
</div>
</div>
</li>

<li><a id="org89c8c88"></a>Define Vale linters<br />
<div class="outline-text-5" id="text-2-18-10-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">flycheck-define-checker</span> vale-error
  <span style="color: #9ac8e0;">"A checker for prose errors."</span>
  <span style="color: #f78fe7;">:command</span> (<span style="color: #79a8ff;">"~/bin/vale"</span> <span style="color: #79a8ff;">"--minAlertLevel"</span> <span style="color: #79a8ff;">"error"</span> source)
  <span style="color: #f78fe7;">:standard-input</span> nil
  <span style="color: #f78fe7;">:error-patterns</span>
  ((<span style="color: #fec43f;">error</span> line-start (file-name) <span style="color: #79a8ff;">":"</span> line <span style="color: #79a8ff;">":"</span> column <span style="color: #79a8ff;">":"</span> (id (one-or-more (not (any <span style="color: #79a8ff;">":"</span>)))) <span style="color: #79a8ff;">":"</span> (message) line-end))
  <span style="color: #f78fe7;">:modes</span> (markdown-mode org-mode text-mode))
(<span style="color: #b6a0ff;">flycheck-define-checker</span> vale-warning
  <span style="color: #9ac8e0;">"A checker for prose warnings."</span>
  <span style="color: #f78fe7;">:command</span> (<span style="color: #79a8ff;">"~/bin/vale"</span> <span style="color: #79a8ff;">"--minAlertLevel"</span> <span style="color: #79a8ff;">"warning"</span> source)
  <span style="color: #f78fe7;">:standard-input</span> nil
  <span style="color: #f78fe7;">:error-patterns</span>
  ((warning line-start (file-name) <span style="color: #79a8ff;">":"</span> line <span style="color: #79a8ff;">":"</span> column <span style="color: #79a8ff;">":"</span> (id (one-or-more (not (any <span style="color: #79a8ff;">":"</span>)))) <span style="color: #79a8ff;">":"</span> (message) line-end))
  <span style="color: #f78fe7;">:modes</span> (markdown-mode org-mode text-mode))
(add-to-list 'flycheck-checkers 'vale-error 'append)
(add-to-list 'flycheck-checkers 'vale-warning 'append)
</pre>
</div>
</div>
</li>

<li><a id="org0c322b2"></a>Define <code>doc-validator</code> linter<br />
<div class="outline-text-5" id="text-2-18-10-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">flycheck-define-checker</span> doc-validator
    <span style="color: #9ac8e0;">"A checker Hugo Markdown source."</span>
    <span style="color: #f78fe7;">:command</span> (<span style="color: #79a8ff;">"~/bin/doc-validator"</span> source source-original)
    <span style="color: #f78fe7;">:standard-input</span> nil
    <span style="color: #f78fe7;">:error-patterns</span>
    ((<span style="color: #fec43f;">error</span> line-start <span style="color: #79a8ff;">"ERROR: "</span> (file-name) <span style="color: #79a8ff;">":"</span> line <span style="color: #79a8ff;">":"</span> column <span style="color: #79a8ff;">" "</span> (message) line-end))
    <span style="color: #f78fe7;">:modes</span> (markdown-mode org-mode text-mode))
  (add-to-list 'flycheck-checkers 'doc-validator 'append)
</pre>
</div>
</div>
</li>

<li><a id="orgd506401"></a>Code aware spell checking<br />
<div class="outline-text-5" id="text-2-18-10-4">
<aside>
<div class="note" id="org5a64afc">
<p>
<b><b>NOTE:</b></b> This is purposefully defined after the Vale and doc-validator linters so that flycheck's automatic selection picks those first.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">flycheck-aspell</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:config</span>
  (add-to-list 'flycheck-checkers 'tex-aspell-dynamic 'append)
  (add-to-list 'flycheck-checkers 'markdown-aspell-dynamic 'append)
  (add-to-list 'flycheck-checkers 'html-aspell-dynamic 'append)
  (add-to-list 'flycheck-checkers 'xml-aspell-dynamic 'append)
  (add-to-list 'flycheck-checkers 'mail-aspell-dynamic 'append))
</pre>
</div>
</div>
</li>

<li><a id="org709ff73"></a>Define flycheck linter chain<br />
<div class="outline-text-5" id="text-2-18-10-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(flycheck-add-next-checker 'doc-validator 'vale-error)
(flycheck-add-next-checker 'vale-error '(<span style="color: #fec43f;">error</span> . vale-warning))
(flycheck-add-next-checker 'vale-warning 'markdown-aspell-dynamic)
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgd44c3fa" class="outline-4">
<h4 id="orgd44c3fa"><span class="section-number-4">2.18.11.</span> Nix</h4>
<div class="outline-text-4" id="text-2-18-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">nix-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:init</span> (nix-prettify-global-mode t)
  <span style="color: #f78fe7;">:mode</span> <span style="color: #79a8ff;">"\\.nix\\'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd082c4b" class="outline-4">
<h4 id="orgd082c4b"><span class="section-number-4">2.18.12.</span> River</h4>
<div class="outline-text-4" id="text-2-18-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path <span style="color: #79a8ff;">"~/ext/jdbaldry/river-mode/"</span>)
(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">river-mode</span> <span style="color: #f78fe7;">:hook</span> (before-save . river-format-before-save))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d9a313" class="outline-4">
<h4 id="org5d9a313"><span class="section-number-4">2.18.13.</span> Terraform</h4>
<div class="outline-text-4" id="text-2-18-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">terraform-mode</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:hook</span> (terraform-mode-hook . terraform-format-on-save-mode))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9b770e" class="outline-3">
<h3 id="orgc9b770e"><span class="section-number-3">2.19.</span> Forges</h3>
<div class="outline-text-3" id="text-2-19">
</div>
<div id="outline-container-orgca0c293" class="outline-4">
<h4 id="orgca0c293"><span class="section-number-4">2.19.1.</span> GitHub</h4>
<div class="outline-text-4" id="text-2-19-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">ghub</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:commands</span> ghub-post
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/gh-create-repo</span>(repo)
    <span style="color: #9ac8e0;">"Create a new GitHub repository REPO."</span>
    (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sRepository: \n"</span>)
    (ghub-post <span style="color: #79a8ff;">"/user/repos"</span> nil <span style="color: #f78fe7;">:payload</span> `((name . ,repo)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff3f916" class="outline-3">
<h3 id="orgff3f916"><span class="section-number-3">2.20.</span> Automatically revert buffers if the file changes</h3>
<div class="outline-text-3" id="text-2-20">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-auto-revert-mode 1)
(add-hook 'dired-mode-hook 'auto-revert-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a70b76" class="outline-3">
<h3 id="org1a70b76"><span class="section-number-3">2.21.</span> Use magit for git</h3>
<div class="outline-text-3" id="text-2-21">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;; </span><span style="color: #989898;">TODO: What is looking for a *usually* void variables `</span><span style="color: #00bcff;">n</span><span style="color: #989898;">' and `</span><span style="color: #00bcff;">x</span><span style="color: #989898;">'?</span>
(<span style="color: #b6a0ff;">setq-default</span> n nil)
(<span style="color: #b6a0ff;">setq-default</span> x nil)
(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">magit</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:commands</span> (magit-status magit-display-buffer-same-window-except-diff-v1)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1)
  <span style="color: #f78fe7;">:defer</span> nil
  <span style="color: #f78fe7;">:init</span> (global-set-key (kbd <span style="color: #79a8ff;">"C-x g"</span>) #'magit-status))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">transient</span> <span style="color: #f78fe7;">:config</span> (<span style="color: #b6a0ff;">setq</span> transient-default-level 7))
</pre>
</div>
</div>

<div id="outline-container-org33130b6" class="outline-4">
<h4 id="org33130b6"><span class="section-number-4">2.21.1.</span> Use difftastic for diffing</h4>
<div class="outline-text-4" id="text-2-21-1">
<p>
From <a href="https://tsdh.org/posts/2022-08-01-difftastic-diffing-with-magit.html">https://tsdh.org/posts/2022-08-01-difftastic-diffing-with-magit.html</a>.
</p>

<aside>
<div class="note" id="org87e78a8">
<p>
<b><b>NOTE:</b></b> This is not currently in use.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">transient</span>
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">xterm-color</span>)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">th/magit--with-difftastic</span> (buffer command)
    <span style="color: #9ac8e0;">"Run COMMAND with GIT_EXTERNAL_DIFF=difft then show result in BUFFER."</span>
    (<span style="color: #b6a0ff;">let</span> ((process-environment
           (cons (concat <span style="color: #79a8ff;">"GIT_EXTERNAL_DIFF=difft --width="</span>
                         (number-to-string (frame-width)))
                 process-environment)))
      <span style="color: #989898;">;; </span><span style="color: #989898;">Clear the result buffer (we might regenerate a diff, e.g., for</span>
      <span style="color: #989898;">;; </span><span style="color: #989898;">the current changes in our working directory).</span>
      (<span style="color: #b6a0ff;">with-current-buffer</span> buffer
        (<span style="color: #b6a0ff;">setq</span> buffer-read-only nil)
        (erase-buffer))
      <span style="color: #989898;">;; </span><span style="color: #989898;">Now spawn a process calling the git COMMAND.</span>
      (make-process
       <span style="color: #f78fe7;">:name</span> (buffer-name buffer)
       <span style="color: #f78fe7;">:buffer</span> buffer
       <span style="color: #f78fe7;">:command</span> command
       <span style="color: #989898;">;; </span><span style="color: #989898;">Don't query for running processes when emacs is quit.</span>
       <span style="color: #f78fe7;">:noquery</span> t
       <span style="color: #989898;">;; </span><span style="color: #989898;">Show the result buffer once the process has finished.</span>
       <span style="color: #f78fe7;">:sentinel</span> (<span style="color: #b6a0ff;">lambda</span> (proc event)
                   (<span style="color: #b6a0ff;">when</span> (eq (process-status proc) 'exit)
                     (<span style="color: #b6a0ff;">with-current-buffer</span> (process-buffer proc)
                       (goto-char (point-min))
                       (xterm-color-colorize-buffer)
                       (<span style="color: #b6a0ff;">setq</span> buffer-read-only t)
                       (view-mode)
                       (end-of-line)
                       <span style="color: #989898;">;; </span><span style="color: #989898;">difftastic diffs are usually 2-column side-by-side,</span>
                       <span style="color: #989898;">;; </span><span style="color: #989898;">so ensure our window is wide enough.</span>
                       (<span style="color: #b6a0ff;">let</span> ((width (current-column)))
                         (<span style="color: #b6a0ff;">while</span> (zerop (forward-line 1))
                           (end-of-line)
                           (<span style="color: #b6a0ff;">setq</span> width (max (current-column) width)))
                         <span style="color: #989898;">;; </span><span style="color: #989898;">Add column size of fringes</span>
                         (<span style="color: #b6a0ff;">setq</span> width (+ width
                                        (fringe-columns 'left)
                                        (fringe-columns 'right)))
                         (goto-char (point-min))
                         (pop-to-buffer
                          (current-buffer)
                          `(<span style="color: #989898;">;; </span><span style="color: #989898;">If the buffer is that wide that splitting the frame in</span>
                            <span style="color: #989898;">;; </span><span style="color: #989898;">two side-by-side windows would result in less than</span>
                            <span style="color: #989898;">;; </span><span style="color: #989898;">80 columns left, ensure it's shown at the bottom.</span>
                            ,(<span style="color: #b6a0ff;">when</span> (&gt; 80 (- (frame-width) width))
                               #'display-buffer-at-bottom)
                            (window-width
                             . ,(min width (frame-width))))))))))))
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">th/magit-show-with-difftastic</span> (rev)
    <span style="color: #9ac8e0;">"Show the result of \"git show REV\" with GIT_EXTERNAL_DIFF=difft."</span>
    (<span style="color: #b6a0ff;">interactive</span>
     (list (<span style="color: #b6a0ff;">or</span>
            <span style="color: #989898;">;; </span><span style="color: #989898;">If REV is given, just use it.</span>
            (<span style="color: #b6a0ff;">when</span> (boundp 'rev) rev)
            <span style="color: #989898;">;; </span><span style="color: #989898;">If not invoked with prefix arg, try to guess the REV from</span>
            <span style="color: #989898;">;; </span><span style="color: #989898;">point's position.</span>
            (<span style="color: #b6a0ff;">and</span> (not current-prefix-arg)
                 (<span style="color: #b6a0ff;">or</span> (thing-at-point 'git-revision t)
                     (magit-branch-or-commit-at-point)))
            <span style="color: #989898;">;; </span><span style="color: #989898;">Otherwise, query the user.</span>
            (magit-read-branch-or-commit <span style="color: #79a8ff;">"Revision"</span>))))
    (<span style="color: #b6a0ff;">if</span> (not rev)
        (<span style="color: #fec43f;">error</span> <span style="color: #79a8ff;">"No revision specified"</span>)
      (th/magit--with-difftastic
       (get-buffer-create (concat <span style="color: #79a8ff;">"*git show difftastic "</span> rev <span style="color: #79a8ff;">"*"</span>))
       (list <span style="color: #79a8ff;">"git"</span> <span style="color: #79a8ff;">"--no-pager"</span> <span style="color: #79a8ff;">"show"</span> <span style="color: #79a8ff;">"--ext-diff"</span> rev))))
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">th/magit-diff-with-difftastic</span> (arg)
    <span style="color: #9ac8e0;">"Show the result of \"git diff ARG\" with GIT_EXTERNAL_DIFF=difft."</span>
    (<span style="color: #b6a0ff;">interactive</span>
     (list (<span style="color: #b6a0ff;">or</span>
            <span style="color: #989898;">;; </span><span style="color: #989898;">If RANGE is given, just use it.</span>
            (<span style="color: #b6a0ff;">when</span> (boundp 'range) range)
            <span style="color: #989898;">;; </span><span style="color: #989898;">If prefix arg is given, query the user.</span>
            (<span style="color: #b6a0ff;">and</span> current-prefix-arg
                 (magit-diff-read-range-or-commit <span style="color: #79a8ff;">"Range"</span>))
            <span style="color: #989898;">;; </span><span style="color: #989898;">Otherwise, auto-guess based on position of point, e.g., based on</span>
            <span style="color: #989898;">;; </span><span style="color: #989898;">if we are in the Staged or Unstaged section.</span>
            (<span style="color: #b6a0ff;">pcase</span> (magit-diff--dwim)
              ('unmerged (<span style="color: #fec43f;">error</span> <span style="color: #79a8ff;">"unmerged is not yet implemented"</span>))
              ('unstaged nil)
              ('staged <span style="color: #79a8ff;">"--cached"</span>)
              (`(stash . ,value) (<span style="color: #fec43f;">error</span> <span style="color: #79a8ff;">"stash is not yet implemented"</span>))
              (`(commit . ,value) (format <span style="color: #79a8ff;">"%s^..%s"</span> value value))
              ((<span style="color: #b6a0ff;">and</span> range (pred stringp)) range)
              (_ (magit-diff-read-range-or-commit <span style="color: #79a8ff;">"Range/Commit"</span>))))))
    (<span style="color: #b6a0ff;">let</span> ((name (concat <span style="color: #79a8ff;">"*git diff difftastic"</span>
                        (<span style="color: #b6a0ff;">if</span> arg (concat <span style="color: #79a8ff;">" "</span> arg) <span style="color: #79a8ff;">""</span>)
                        <span style="color: #79a8ff;">"*"</span>)))
      (th/magit--with-difftastic
       (get-buffer-create name)
       `(<span style="color: #79a8ff;">"git"</span> <span style="color: #79a8ff;">"--no-pager"</span> <span style="color: #79a8ff;">"diff"</span> <span style="color: #79a8ff;">"--ext-diff"</span> ,@(<span style="color: #b6a0ff;">when</span> arg (list arg))))))
  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">jdb/magit-difftastic</span> ()
    <span style="color: #9ac8e0;">"Personal magit commands."</span>
    [<span style="color: #79a8ff;">"Difftastic"</span>
     (<span style="color: #79a8ff;">"d"</span> <span style="color: #79a8ff;">"Difftastic Diff (dwim)"</span> th/magit-diff-with-difftastic)
     (<span style="color: #79a8ff;">"s"</span> <span style="color: #79a8ff;">"Difftastic Show"</span> th/magit-show-with-difftastic)])
  (define-key magit-status-mode-map (kbd <span style="color: #79a8ff;">"~"</span>) #'jdb/magit-difftastic)
  (transient-insert-suffix 'magit-dispatch (kbd <span style="color: #79a8ff;">"h"</span>) '(<span style="color: #79a8ff;">"~"</span> <span style="color: #79a8ff;">"Difftastic"</span> jdb/magit-difftastic)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f497f0" class="outline-4">
<h4 id="org9f497f0"><span class="section-number-4">2.21.2.</span> Add personal transients</h4>
<div class="outline-text-4" id="text-2-21-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">transient</span>
  <span style="color: #f78fe7;">:after</span> magit
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/list-files</span> (_ _ _)
    (<span style="color: #b6a0ff;">let</span> ((prune '(games .yarn .runelite ext .npm .Garmin Maildir .emacs_saves node_modules Slack BraveSoftware .zoom retroarch Code emojis elpa CacheStorage .git chromium go .cache .mozilla .kube .local nix vendor)))
      (split-string (shell-command-to-string (concat <span style="color: #79a8ff;">"find "</span> (projectile-project-root) <span style="color: #79a8ff;">" "</span> (string-join (mapcar (<span style="color: #b6a0ff;">lambda</span> (base) (format <span style="color: #79a8ff;">"-name '</span><span style="color: #00bcff;">%s</span><span style="color: #79a8ff;">' -prune -o"</span> base)) prune) <span style="color: #79a8ff;">" "</span>) <span style="color: #79a8ff;">" -print"</span>)) <span style="color: #79a8ff;">"\n"</span>)))
  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">jdb/add</span> ()
    (<span style="color: #b6a0ff;">interactive</span>)
    (ivy-read <span style="color: #79a8ff;">"Add file: "</span>
              #'jdb/list-files
              <span style="color: #f78fe7;">:action</span> #'(<span style="color: #b6a0ff;">lambda</span> (file) (magit-run-git <span style="color: #79a8ff;">"add"</span> <span style="color: #79a8ff;">"--"</span> file))
              <span style="color: #f78fe7;">:caller</span> 'jdb/add))
  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">jdb/rm</span> ()
    (<span style="color: #b6a0ff;">interactive</span>)
    (ivy-read <span style="color: #79a8ff;">"Remove file: "</span>
              #'jdb/list-files
              <span style="color: #f78fe7;">:action</span> #'(<span style="color: #b6a0ff;">lambda</span> (file) (magit-run-git <span style="color: #79a8ff;">"rm"</span> <span style="color: #79a8ff;">"--"</span> file))
              <span style="color: #f78fe7;">:caller</span> 'jdb/rm))
  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">jdb/magit-aux</span> ()
    <span style="color: #9ac8e0;">"Personal magit commands."</span>
    [<span style="color: #79a8ff;">"Auxiliary commands"</span>
     (<span style="color: #79a8ff;">"a"</span> <span style="color: #79a8ff;">"Add"</span> jdb/add)
     (<span style="color: #79a8ff;">"r"</span> <span style="color: #79a8ff;">"Remove"</span> jdb/rm)])
  (define-key magit-status-mode-map (kbd <span style="color: #79a8ff;">"#"</span>) #'jdb/magit-aux)
  (transient-insert-suffix 'magit-dispatch (kbd <span style="color: #79a8ff;">"h"</span>) '(<span style="color: #79a8ff;">"#"</span> <span style="color: #79a8ff;">"Aux"</span> jdb/magit-aux)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8d2ddd6" class="outline-3">
<h3 id="org8d2ddd6"><span class="section-number-3">2.22.</span> Org export</h3>
<div class="outline-text-3" id="text-2-22">
</div>
<div id="outline-container-org42ae5a3" class="outline-4">
<h4 id="org42ae5a3"><span class="section-number-4">2.22.1.</span> Enable syntax highlighting</h4>
<div class="outline-text-4" id="text-2-22-1">
<aside>
<div class="note" id="orgb87c121">
<p>
<b><b>NOTE:</b></b> The theme relies on a black background and white text ({background-color: #111111; color: #ffffff}).
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">htmlize</span> <span style="color: #f78fe7;">:ensure</span> t <span style="color: #f78fe7;">:after</span> org)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f007e4" class="outline-4">
<h4 id="org0f007e4"><span class="section-number-4">2.22.2.</span> Enable Markdown export</h4>
<div class="outline-text-4" id="text-2-22-2">
<aside>
<div class="note" id="orga5706e7">
<p>
<b><b>NOTE:</b></b> This still needs plenty of work to let org be my single source for producing content when so many places rely on prettier Markdown GitHub Flavored Markdown output.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">ox-gfm</span>
  <span style="color: #f78fe7;">:after</span> org
  <span style="color: #f78fe7;">:config</span> (add-to-list 'org-export-backends 'gfm))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org736ade0" class="outline-3">
<h3 id="org736ade0"><span class="section-number-3">2.23.</span> Task management</h3>
<div class="outline-text-3" id="text-2-23">
</div>
<div id="outline-container-org0b3685a" class="outline-4">
<h4 id="org0b3685a"><span class="section-number-4">2.23.1.</span> Utilities</h4>
<div class="outline-text-4" id="text-2-23-1">
<p>
Define a regexp for capturing both parts of org-style links.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defconst</span> <span style="color: #00d3d0;">org-link-regexp</span>
  (<span style="color: #b6a0ff;">rx</span> <span style="color: #79a8ff;">"[["</span> (group (one-or-more anything)) <span style="color: #79a8ff;">"]["</span> (group (one-or-more anything)) <span style="color: #79a8ff;">"]]"</span>)
  <span style="color: #9ac8e0;">"Regexp to match `</span><span style="color: #00bcff;">org-mode</span><span style="color: #9ac8e0;">' links in the form [[link][text]].</span>
<span style="color: #9ac8e0;">There are capture groups for the link and text components."</span>)
</pre>
</div>

<p>
Use the Pomodoro technique
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">org-pomodoro</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:hook</span> (org-pomodoro-finished . (<span style="color: #b6a0ff;">lambda</span> () (message <span style="color: #79a8ff;">"Pomodoro complete!"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">org</span>
  <span style="color: #f78fe7;">:bind</span>
  ((<span style="color: #79a8ff;">"C-c l"</span> . org-store-link)
   (<span style="color: #79a8ff;">"C-c a"</span> . org-agenda)
   (<span style="color: #79a8ff;">"C-c c"</span> . org-capture))
  (<span style="color: #79a8ff;">"C-c C-l u"</span> . jdb/urgent)
  (<span style="color: #79a8ff;">"C-c C-l i"</span> . jdb/important)
  <span style="color: #f78fe7;">:hook</span>
  (org-clock-in . jdb/org-slack-status)
  (org-clock-in . (<span style="color: #b6a0ff;">lambda</span> () (org-todo <span style="color: #79a8ff;">"PRGR"</span>)))
  (org-clock-out . (<span style="color: #b6a0ff;">lambda</span> () (jdb/slack-status <span style="color: #79a8ff;">""</span> <span style="color: #79a8ff;">""</span>)))
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> org-startup-folded t)
  (<span style="color: #b6a0ff;">setq</span> org-adapt-indentation nil)
  (<span style="color: #b6a0ff;">setq</span> org-todo-keywords
        '((sequence <span style="color: #79a8ff;">"TODO"</span> <span style="color: #79a8ff;">"PRGR"</span> <span style="color: #79a8ff;">"DONE"</span>) (type <span style="color: #79a8ff;">"NOTD"</span>)))
  (<span style="color: #b6a0ff;">setq</span> org-todo-keyword-faces '((<span style="color: #79a8ff;">"PRGR"</span> . <span style="color: #79a8ff;">"orange"</span>) (<span style="color: #79a8ff;">"NOTD"</span> . <span style="color: #79a8ff;">"blue"</span>)))
  (<span style="color: #b6a0ff;">setq</span> org-log-done 'time)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-30m</span> () <span style="color: #9ac8e0;">"Update effort to 30 minutes."</span> (<span style="color: #b6a0ff;">interactive</span>) (org-set-effort nil <span style="color: #79a8ff;">"0:30"</span>))
  (org-defkey org-mode-map (kbd <span style="color: #79a8ff;">"C-c C-x 3"</span>) #'jdb/org-30m)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-1h</span> () <span style="color: #9ac8e0;">"Update effort to one hour."</span> (<span style="color: #b6a0ff;">interactive</span>) (org-set-effort nil <span style="color: #79a8ff;">"1:00"</span>))
  (org-defkey org-mode-map (kbd <span style="color: #79a8ff;">"C-c C-x 1"</span>) #'jdb/org-1h)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-insert-link-with-title</span> (url)
    <span style="color: #9ac8e0;">"Insert URL with a description from the title."</span>
    (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
    (org-insert-link nil url (jdb/tag-for-url url 'title))))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">org-clock</span>)

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/format-YYYY-mm-dd</span> (<span style="color: #6ae4b9;">&amp;optional</span> time)
  <span style="color: #9ac8e0;">"Format TIME to YYYY-mm-dd.</span>
<span style="color: #9ac8e0;">If TIME is not provided, it defaults to the current time."</span>
  (format-time-string <span style="color: #79a8ff;">"%Y-%m-%d"</span> time))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/next-working-day</span> ()
  <span style="color: #9ac8e0;">"Return the time of the next working day."</span>
  (<span style="color: #b6a0ff;">let</span> ((today (string-to-number (format-time-string <span style="color: #79a8ff;">"%u"</span>))))
    (<span style="color: #b6a0ff;">if</span> (&gt;= today 5) (+ (time-convert nil 'integer) (* (- 8 today) 86400))
      (+ (time-convert nil 'integer) 86400))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-file</span> (<span style="color: #6ae4b9;">&amp;optional</span> time)
  <span style="color: #9ac8e0;">"Return the org file for the day that TIME falls within.</span>
<span style="color: #9ac8e0;">If TIME is not provided it defaults to the current time."</span>
  (format <span style="color: #79a8ff;">"~/org/%s.org"</span> (jdb/format-YYYY-mm-dd time)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-today</span> ()
  <span style="color: #9ac8e0;">"Create or open the org file for today."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (find-file (jdb/org-file)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-tomorrow</span> ()
  <span style="color: #9ac8e0;">"Create or open the org file for tomorrow."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (find-file (jdb/org-file (+ (time-convert nil 'integer) 86400))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-next</span> ()
  <span style="color: #9ac8e0;">"Create or open the next org file, only considering work days."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (find-file (jdb/org-file (jdb/next-working-day))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-file-prev</span> ()
  <span style="color: #9ac8e0;">"Return the org file for the previous working day.</span>
<span style="color: #9ac8e0;">This relies on the sorted file names as `</span><span style="color: #00bcff;">yesterday</span><span style="color: #9ac8e0;">' isn't necessary the</span>
<span style="color: #9ac8e0;">last file when files are only created on weekdays."</span>
  (<span style="color: #b6a0ff;">let</span> ((yesterday (jdb/org-file (- (time-convert nil 'integer) 86400))))
    (<span style="color: #b6a0ff;">cond</span> ((file-exists-p yesterday) yesterday)
          ((file-exists-p (jdb/org-file))
           (car (last (butlast (directory-files <span style="color: #79a8ff;">"~/org"</span> t <span style="color: #79a8ff;">"[0-9]\\{</span><span style="color: #00d3d0;">4\\</span><span style="color: #79a8ff;">}-[0-9]\\{</span><span style="color: #00d3d0;">2\\</span><span style="color: #79a8ff;">}-[0-9]\\{</span><span style="color: #00d3d0;">2\\</span><span style="color: #79a8ff;">}.org$"</span>)))))
          (t (car (last (directory-files <span style="color: #79a8ff;">"~/org"</span> t <span style="color: #79a8ff;">"[0-9]\\{</span><span style="color: #00d3d0;">4\\</span><span style="color: #79a8ff;">}-[0-9]\\{</span><span style="color: #00d3d0;">2\\</span><span style="color: #79a8ff;">}-[0-9]\\{</span><span style="color: #00d3d0;">2\\</span><span style="color: #79a8ff;">}.org$"</span>)))))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-prev</span> ()
  <span style="color: #9ac8e0;">"Open the org file for the previous working day."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (find-file (jdb/org-file-prev)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-skip</span> ()
  <span style="color: #9ac8e0;">"Skip subtrees with a :personal: tag."</span>
  (<span style="color: #b6a0ff;">let</span> ((subtree-end (<span style="color: #b6a0ff;">save-excursion</span> (org-end-of-subtree t))))
    (<span style="color: #b6a0ff;">if</span> (member <span style="color: #79a8ff;">"personal"</span> (org-get-tags (point) t))
        subtree-end
      nil)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/add-tag</span> (tag)
  <span style="color: #9ac8e0;">"Add TAG to current headline."</span>
  (org-set-tags (sort (cons tag (org-get-tags (point) t)) 'string-lessp)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-urgent</span> () <span style="color: #9ac8e0;">"Add urgent tag to headline."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/add-tag <span style="color: #79a8ff;">"urgent"</span>))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-important</span> () <span style="color: #9ac8e0;">"Add important tag to headline."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/add-tag <span style="color: #79a8ff;">"important"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-standup--remaining-effort</span> ()
  <span style="color: #9ac8e0;">"Return the remaining effort in minutes for the org-entry at point."</span>
  (max
   (-
    (org-duration-to-minutes (<span style="color: #b6a0ff;">or</span> (org-entry-get (point) <span style="color: #79a8ff;">"EFFORT"</span>) <span style="color: #79a8ff;">"0:00"</span>))
    (org-duration-to-minutes (org-clock-sum-current-item)))
   0.0))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-standup--org-to-standup</span> ()
  <span style="color: #9ac8e0;">"Translate the `</span><span style="color: #00bcff;">org-todo</span><span style="color: #9ac8e0;">' entry at point into a standup entry."</span>
  (format <span style="color: #79a8ff;">"- %s (EST %s) %s%s"</span>
          (org-entry-get (point) <span style="color: #79a8ff;">"TODO"</span>)
          (format-seconds <span style="color: #79a8ff;">"%02h:%02m"</span> (* 60 (jdb/org-standup--remaining-effort)))
          (replace-regexp-in-string org-link-regexp
                                    <span style="color: #79a8ff;">"[\\2](\\1)"</span>
                                    (org-entry-get (point) <span style="color: #79a8ff;">"ITEM"</span>))
          (<span style="color: #b6a0ff;">let*</span> ((tags (split-string (<span style="color: #b6a0ff;">or</span> (car (last (org-heading-components))) <span style="color: #79a8ff;">""</span>) <span style="color: #79a8ff;">":"</span>))
                 (tag-string (concat
                              (<span style="color: #b6a0ff;">if</span> (member <span style="color: #79a8ff;">"urgent"</span> tags) <span style="color: #79a8ff;">"U"</span>)
                              (<span style="color: #b6a0ff;">if</span> (member <span style="color: #79a8ff;">"important"</span> tags) <span style="color: #79a8ff;">"I"</span>))))
            (<span style="color: #b6a0ff;">if</span> (string-empty-p tag-string) <span style="color: #79a8ff;">""</span> (format <span style="color: #79a8ff;">" [%s]"</span> tag-string)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-standup</span> ()
  <span style="color: #9ac8e0;">"Translate `</span><span style="color: #00bcff;">org-todo</span><span style="color: #9ac8e0;">' entries into Slack standup message in kill ring."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((total 0))
    (org-map-entries (<span style="color: #b6a0ff;">lambda</span> () (set 'total (+ total (* 60 (jdb/org-standup--remaining-effort)))))
                     t
                     `(,(jdb/org-file))
                     #'jdb/org-skip)
    (kill-new (string-join
               `(<span style="color: #79a8ff;">"*Today*"</span>
                 ,@(org-map-entries 'jdb/org-standup--org-to-standup
                                    t
                                    `(,(jdb/org-file))
                                    #'jdb/org-skip)
                 ,(format <span style="color: #79a8ff;">"TOTAL %s"</span> (format-seconds <span style="color: #79a8ff;">"%02h:%02m"</span> total)))
               <span style="color: #79a8ff;">"\n"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-standup-last</span> ()
  <span style="color: #9ac8e0;">"Translate `</span><span style="color: #00bcff;">org-todo</span><span style="color: #9ac8e0;">' entries into a Slack standup for time spent yesterday."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((total 0)
        (yesterday-start (-
                          (string-to-number
                           (shell-command-to-string <span style="color: #79a8ff;">"date -d '' +%s"</span>))
                          86400)))
    (kill-new (string-join
               `(<span style="color: #79a8ff;">"*Last*"</span>
                 ,@(org-map-entries
                    '(format <span style="color: #79a8ff;">"- %s (ACT %s ACC %3d&#1642;) %s"</span>
                             (org-entry-get (point) <span style="color: #79a8ff;">"TODO"</span>)
                             (<span style="color: #b6a0ff;">progn</span>
                               (set 'total (+ total (* 60 (<span style="color: #b6a0ff;">or</span> (org-clock-sum-current-item yesterday-start) 0))))
                               (format-seconds <span style="color: #79a8ff;">"%02h:%02m"</span> (* 60 (<span style="color: #b6a0ff;">or</span> (org-clock-sum-current-item yesterday-start) 0))))
                             (<span style="color: #b6a0ff;">let*</span> ((split (split-string (<span style="color: #b6a0ff;">or</span> (org-entry-get (point) <span style="color: #79a8ff;">"EFFORT"</span>) <span style="color: #79a8ff;">"00:00"</span>) <span style="color: #79a8ff;">":"</span>))
                                    (hours (string-to-number (car split)))
                                    (mins (string-to-number (cadr split)))
                                    (effort-in-seconds (+ (* 3600 hours) (* 60 mins))))
                               (* 100
                                  (+ 1
                                     (/
                                      (- (* 60.0 (<span style="color: #b6a0ff;">or</span> (org-clock-sum-current-item yesterday-start) 0)) effort-in-seconds)
                                      effort-in-seconds))))
                             (replace-regexp-in-string org-link-regexp
                                                       <span style="color: #79a8ff;">"[\\2](\\1)"</span>
                                                       (org-entry-get (point) <span style="color: #79a8ff;">"ITEM"</span>)))
                    t
                    `(,(jdb/org-file-prev))
                    #'jdb/org-skip)
                 ,(format <span style="color: #79a8ff;">"TOTAL %s"</span> (format-seconds <span style="color: #79a8ff;">"%02h:%02m"</span> total)))
               <span style="color: #79a8ff;">"\n"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-carryover</span> ()
  <span style="color: #9ac8e0;">"Carry over unfinished tasks from the previous day."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((curr (jdb/org-file))
        (prev (jdb/org-file-prev)))
    (org-map-entries
     (<span style="color: #b6a0ff;">lambda</span> ()
       (<span style="color: #b6a0ff;">let</span> ((entry (buffer-substring-no-properties (org-entry-beginning-position) (org-entry-end-position))))
         (<span style="color: #b6a0ff;">with-current-buffer</span> (find-file curr)
           (goto-char (point-max))
           (insert entry)
           (save-buffer))))
     nil
     (list prev)
     (<span style="color: #b6a0ff;">lambda</span> ()
       (<span style="color: #b6a0ff;">let</span> ((subtree-end (<span style="color: #b6a0ff;">save-excursion</span> (org-end-of-subtree t)))
             (todo (org-entry-get (point) <span style="color: #79a8ff;">"TODO"</span>)))
         (<span style="color: #b6a0ff;">if</span> (<span style="color: #b6a0ff;">or</span> (string= todo <span style="color: #79a8ff;">"DONE"</span>) (string= todo <span style="color: #79a8ff;">"NOTD"</span>))
             subtree-end
           nil))))))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-timetable</span> ()
  <span style="color: #9ac8e0;">"Append a time table to the current buffer."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">with-current-buffer</span> (current-buffer)
    (goto-char (point-max))
    (insert (string-join '(<span style="color: #79a8ff;">"* Total"</span>
                           <span style="color: #79a8ff;">"  #+COLUMNS: %ITEM %TODO %4EFFORT(EST){:} %CLOCKSUM(ACT)"</span>
                           <span style="color: #79a8ff;">"  #+BEGIN: columnview :hlines 1 :id global"</span>
                           <span style="color: #79a8ff;">"  | ITEM | TODO |  EST | ACT |"</span>
                           <span style="color: #79a8ff;">"  #+TBLFM:@&gt;$3=vsum(@2..@-1);T::@&gt;$4=vsum(@2..@-1);T"</span>
                           <span style="color: #79a8ff;">"  #+END:"</span>) <span style="color: #fec43f;">"\n"</span><span style="color: #fec43f;">))))</span>

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-pomodoro-kill</span> () <span style="color: #9ac8e0;">"Cancel a Pomodoro countdown."</span> (<span style="color: #b6a0ff;">interactive</span>) (org-pomodoro-kill))
</pre>
</div>
</div>
</div>

<div id="outline-container-org46f2871" class="outline-4">
<h4 id="org46f2871"><span class="section-number-4">2.23.2.</span> Interact with Slack</h4>
<div class="outline-text-4" id="text-2-23-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">request</span>)
(<span style="color: #b6a0ff;">defvar</span> <span style="color: #00d3d0;">jdb/slack-api-url</span> <span style="color: #79a8ff;">"https://slack.com/api"</span>)
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-url-post</span> (endpoint data <span style="color: #6ae4b9;">&amp;optional</span> callback)
  <span style="color: #9ac8e0;">"Make a POST request to Slack.</span>
<span style="color: #9ac8e0;">ENDPOINT is a Slack RPC endpoint such as users.profile.set.</span>
<span style="color: #9ac8e0;">DATA is the request body.</span>
<span style="color: #9ac8e0;">CALLBACK is called on completion."</span>
  (request (format <span style="color: #79a8ff;">"%s/%s"</span> jdb/slack-api-url endpoint)
    <span style="color: #f78fe7;">:type</span> <span style="color: #79a8ff;">"POST"</span>
    <span style="color: #f78fe7;">:headers</span> `((<span style="color: #79a8ff;">"Content-Type"</span> . <span style="color: #79a8ff;">"application/json; charset=utf-8"</span>)
               (<span style="color: #79a8ff;">"Authorization"</span> . ,(concat <span style="color: #79a8ff;">"Bearer "</span> (auth-source-pass-get 'secret <span style="color: #79a8ff;">"grafana/raintank-corp.slack.com"</span>))))
    <span style="color: #f78fe7;">:data</span> data
    <span style="color: #f78fe7;">:parser</span> 'json-read
    <span style="color: #f78fe7;">:complete</span> (<span style="color: #b6a0ff;">or</span> callback (<span style="color: #b6a0ff;">cl-function</span>
                            (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;key</span> response <span style="color: #6ae4b9;">&amp;allow-other-keys</span>)
                              (message <span style="color: #79a8ff;">"%s: %s"</span>
                                       (request-response-status-code response)
                                       (request-response-data response)))))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-standup</span> (text)
  <span style="color: #9ac8e0;">"Post a standup message TEXT to the standup channel."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sText: \n"</span>)
  (jdb/slack-url-post <span style="color: #79a8ff;">"chat.postMessage"</span>
                      (json-encode
                       `((channel . <span style="color: #79a8ff;">"C039JG5NDLP"</span>)
                         (text . ,text)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-react</span> (channel timestamp name)
  <span style="color: #9ac8e0;">"React to the TIMESTAMP in CHANNEL with emoji identified by NAME."</span>
  (jdb/slack-url-post <span style="color: #79a8ff;">"react.add"</span>
                      (json-encode
                       `((channel . ,channel)
                         (timestamp . ,timestamp)
                         (name . ,name)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-react-callback</span> (channel timestamp text)
  <span style="color: #9ac8e0;">"Return a `</span><span style="color: #00bcff;">cl-function</span><span style="color: #9ac8e0;">' that can be used as a request callback.</span>
<span style="color: #9ac8e0;">The callback reacts to the TIMESTAMP message in CHANNEL with the</span>
<span style="color: #9ac8e0;">alphabet emoji of the first character in TEXT."</span>
  (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;key</span> response <span style="color: #6ae4b9;">&amp;allow-other-keys</span>)
    (<span style="color: #b6a0ff;">if</span> (&gt; (length text) 1)
        (funcall (jdb/slack-react-callback channel timestamp (substring text 1)) <span style="color: #f78fe7;">:response</span> response <span style="color: #f78fe7;">:other-keys</span>)
      (jdb/slack-react channel timestamp (string-to-char text)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-post-with-react</span> (text channel <span style="color: #6ae4b9;">&amp;optional</span> message)
  <span style="color: #9ac8e0;">"Post TEXT to CHANNEL and react with TEXT alphabet emoji.</span>
<span style="color: #9ac8e0;">If MESSAGE is non-nil, post that instead of TEXT."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sText: \nsChannel: \n"</span>)
  (jdb/slack-url-post
   <span style="color: #79a8ff;">"chat.postMessage"</span>
   (json-encode
    `((channel . ,channel)
      (text . ,text)))
   (<span style="color: #b6a0ff;">cl-function</span> (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;key</span> response <span style="color: #6ae4b9;">&amp;allow-other-keys</span>)
                  (<span style="color: #b6a0ff;">let</span> ((channel (alist-get 'channel (request-response-data response)))
                        (timestamp (alist-get 'ts (request-response-data response)))
                        (text (alist-get 'text (alist-get 'message (request-response-data response)))))
                    (funcall (jdb/slack-react-callback channel timestamp text) <span style="color: #f78fe7;">:response</span> response <span style="color: #f78fe7;">:other-keys</span>))))))

(<span style="color: #b6a0ff;">defvar</span> <span style="color: #00d3d0;">jdb/slack-status-last-emoji</span> nil <span style="color: #9ac8e0;">"Last emoji used in a Slack status API request."</span>)
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-status</span> (text <span style="color: #6ae4b9;">&amp;optional</span> emoji)
  <span style="color: #9ac8e0;">"Update Slack status.  TEXT is the status message.  EMOJI is the status emoji."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sText: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((emoji (<span style="color: #b6a0ff;">or</span> emoji
                   (ivy-read <span style="color: #79a8ff;">"Emoji: "</span>
                             (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;rest</span> _) jdb/slack-status--collection)
                             <span style="color: #f78fe7;">:action</span> (<span style="color: #b6a0ff;">lambda</span> (emoji) (<span style="color: #b6a0ff;">setq</span> jdb/slack-status-last-emoji emoji))
                             <span style="color: #f78fe7;">:caller</span> 'jdb/slack-status))))
    (jdb/slack-url-post
     <span style="color: #79a8ff;">"users.profile.set"</span>
     (json-encode
      `((<span style="color: #79a8ff;">"profile"</span> . ((<span style="color: #79a8ff;">"status_text"</span> . ,text) (<span style="color: #79a8ff;">"status_emoji"</span> . ,emoji)))))
     (<span style="color: #b6a0ff;">cl-function</span>
      (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;key</span> response <span style="color: #6ae4b9;">&amp;allow-other-keys</span>)
        (<span style="color: #b6a0ff;">if</span> (<span style="color: #b6a0ff;">and</span>
             (equal (request-response-status-code response) 200)
             (equal (alist-get 'ok (request-response-data response)) <span style="color: #f78fe7;">:json-false</span>)
             jdb/slack-status-last-emoji)
            (customize-set-variable
             'jdb/slack-status--collection
             (add-to-list 'jdb/slack-status--collection jdb/slack-status-last-emoji))
          (customize-save-customized)))))
    (jdb/slack-url-post
     <span style="color: #79a8ff;">"users.setPresence"</span>
     (json-encode `((<span style="color: #79a8ff;">"presence"</span> . ,(<span style="color: #b6a0ff;">if</span> (string-empty-p text) <span style="color: #79a8ff;">"auto"</span> <span style="color: #79a8ff;">"away"</span>)))))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-clear</span> ()
  <span style="color: #9ac8e0;">"Clear Slack status."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/slack-status <span style="color: #79a8ff;">""</span> <span style="color: #79a8ff;">""</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-status-with-time</span> (text)
  <span style="color: #9ac8e0;">"Update Slack status with TEXT formatted with the current time.</span>
<span style="color: #9ac8e0;">'</span><span style="color: #00bcff;">%s</span><span style="color: #9ac8e0;">' should be used for the text substition."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sText: \n"</span>)
  (funcall-interactively 'jdb/slack-status (format text (format-time-string <span style="color: #79a8ff;">"%H:%M %Z"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-tea</span> ()
  <span style="color: #9ac8e0;">"Update Slack status to reflect the fact I am making a cup of tea."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/slack-status (format <span style="color: #79a8ff;">"started making tea at %s, back in five minutes"</span> (format-time-string <span style="color: #79a8ff;">"%H:%M %Z"</span>)) <span style="color: #79a8ff;">":tea:"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-long-pomodoro</span> ()
  <span style="color: #9ac8e0;">"Update Slack status to reflect that I am on a long Pomodoro break."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/slack-status (format <span style="color: #79a8ff;">"started a long Pomodoro break at %s, back in fifteen minutes"</span> (format-time-string <span style="color: #79a8ff;">"%H:%M %Z"</span>)) <span style="color: #79a8ff;">":tomato:"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-lunch</span> ()
  <span style="color: #9ac8e0;">"Update Slack status to reflect the fact I am having lunch."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((today (string-to-number (format-time-string <span style="color: #79a8ff;">"%u"</span>))))
    (jdb/slack-status (format <span style="color: #79a8ff;">"started lunch at %s, back in one hour"</span> (format-time-string <span style="color: #79a8ff;">"%H:%M %Z"</span>))
                      (<span style="color: #b6a0ff;">if</span> (&gt;= today 5) <span style="color: #79a8ff;">":beer:"</span> <span style="color: #79a8ff;">":shallow_pan_of_food:"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-long-lunch</span> ()
  <span style="color: #9ac8e0;">"Update Slack status to reflect the fact I am having a long lunch."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((today (string-to-number (format-time-string <span style="color: #79a8ff;">"%u"</span>))))
    (jdb/slack-status (format <span style="color: #79a8ff;">"started a long lunch at %s, back in two hours"</span> (format-time-string <span style="color: #79a8ff;">"%H:%M %Z"</span>))
                      (<span style="color: #b6a0ff;">if</span> (&gt;= today 5) <span style="color: #79a8ff;">":beer:"</span> <span style="color: #79a8ff;">":shallow_pan_of_food:"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/slack-done</span> ()
  <span style="color: #9ac8e0;">"Update Slack status to reflect the fact I am no longer working."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/slack-status <span style="color: #79a8ff;">"not working"</span> <span style="color: #79a8ff;">":checkered_flag:"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/conjugate-verb</span> (verb)
  <span style="color: #9ac8e0;">"Conjugate VERB into present tense.  attend -&gt; attending."</span>
  (<span style="color: #b6a0ff;">cond</span> ((string-suffix-p <span style="color: #79a8ff;">"e"</span> verb) (replace-regexp-in-string <span style="color: #79a8ff;">"e$"</span> <span style="color: #79a8ff;">"ing"</span> verb))
        (t (concat verb <span style="color: #79a8ff;">"ing"</span>))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/org-slack-status</span> ()
  <span style="color: #9ac8e0;">"Update Slack status with the current org item.  EMOJI is the status emoji."</span>
  (<span style="color: #b6a0ff;">let*</span> ((todo (replace-regexp-in-string org-link-regexp
                                         <span style="color: #79a8ff;">"\\2"</span>
                                         (org-entry-get (point) <span style="color: #79a8ff;">"ITEM"</span>)))
         (words (split-string todo))
         (verb (car words))
         (conjugated (jdb/conjugate-verb verb))
         (text (string-join (cons conjugated (cdr words)) <span style="color: #79a8ff;">" "</span>)))
    (funcall-interactively 'jdb/slack-status text)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org76e1852" class="outline-4">
<h4 id="org76e1852"><span class="section-number-4">2.23.3.</span> Tests</h4>
<div class="outline-text-4" id="text-2-23-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">ert-deftest</span> <span style="color: #feacd0;">jdb/org-standup--org-to-standup/should-include-urgency-if-present</span> ()
  <span style="color: #9ac8e0;">"If a TODO entry has an `</span><span style="color: #00bcff;">urgent</span><span style="color: #9ac8e0;">' tag, it should be included in the standup entry."</span>
  (<span style="color: #b6a0ff;">let</span> ((org-entry <span style="color: #79a8ff;">"* TODO must do                                   :urgent:important:"</span>)
        (want <span style="color: #79a8ff;">"- TODO (EST ) 00:00 must do [UI]"</span>))
    (<span style="color: #b6a0ff;">with-temp-buffer</span>
      (insert org-entry)
      (goto-char (point-min))
      (<span style="color: #b6a0ff;">let</span> ((got (jdb/org-standup--org-to-standup)))
        (print got)
        (<span style="color: #b6a0ff;">should</span> (equal got want))))))

(<span style="color: #b6a0ff;">ert-deftest</span> <span style="color: #feacd0;">jdb/org-standup--remaining-effort/returns-effort-if-no-logbook</span> ()
  <span style="color: #9ac8e0;">"Remaining effort is effort if there is no clocked time."</span>
  (<span style="color: #b6a0ff;">let</span> ((entry <span style="color: #79a8ff;">"* TODO todo entry</span>
<span style="color: #79a8ff;">   :PROPERTIES:</span>
<span style="color: #79a8ff;">   :Effort:   1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;"> "</span>))
    (<span style="color: #b6a0ff;">with-temp-buffer</span>
      (insert entry)
      (goto-char (point-min))
      (<span style="color: #b6a0ff;">should</span> (equal (jdb/org-standup--remaining-effort) 60.0)))))
(<span style="color: #b6a0ff;">ert-deftest</span> <span style="color: #feacd0;">jdb/org-standup--remaining-effort/returns-effort-sub-clock-if-logbook</span> ()
  <span style="color: #9ac8e0;">"Remaining effort should be the defined effort minus any clocked time."</span>
  (<span style="color: #b6a0ff;">let</span> ((entry <span style="color: #79a8ff;">"* PRGR todo entry</span>
<span style="color: #79a8ff;">   :PROPERTIES:</span>
<span style="color: #79a8ff;">   :Effort:   1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;">   :LOGBOOK:</span>
<span style="color: #79a8ff;">   CLOCK: [1970-01-01 Thu 00:00]--[1970-01-01 Thu 01:00] =&gt;  1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;"> "</span>))
    (<span style="color: #b6a0ff;">with-temp-buffer</span>
      (insert entry)
      (goto-char (point-min))
      (<span style="color: #b6a0ff;">should</span> (equal (jdb/org-standup--remaining-effort) 0.0)))))
(<span style="color: #b6a0ff;">ert-deftest</span> <span style="color: #feacd0;">jdb/org-standup--remaining-effort/returns-zero-for-negative-remaining-effort</span> ()
  <span style="color: #9ac8e0;">"Negative effort remaining is not useful for discussing estimated times."</span>
  (<span style="color: #b6a0ff;">let</span> ((entry <span style="color: #79a8ff;">"* PRGR todo entry</span>
<span style="color: #79a8ff;">   :PROPERTIES:</span>
<span style="color: #79a8ff;">   :Effort:   1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;">   :LOGBOOK:</span>
<span style="color: #79a8ff;">   CLOCK: [1970-01-01 Thu 01:00]--[1970-01-01 Thu 02:00] =&gt;  1:00</span>
<span style="color: #79a8ff;">   CLOCK: [1970-01-01 Thu 00:00]--[1970-01-01 Thu 01:00] =&gt;  1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;">   "</span>))
    (<span style="color: #b6a0ff;">with-temp-buffer</span>
      (insert entry)
      (goto-char (point-min))
      (<span style="color: #b6a0ff;">should</span> (equal (jdb/org-standup--remaining-effort) 0.0)))))
(<span style="color: #b6a0ff;">ert-deftest</span> <span style="color: #feacd0;">jdb/org-standup--remaining-effort/handles-other-entries-in-buffer</span> ()
  <span style="color: #9ac8e0;">"The original implementation would subtract the clock sum of all entries in the buffer."</span>
  (<span style="color: #b6a0ff;">let</span> ((entry <span style="color: #79a8ff;">"* PRGR todo entry</span>
<span style="color: #79a8ff;">   :PROPERTIES:</span>
<span style="color: #79a8ff;">   :Effort:   1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;"> GR other todo entry</span>
<span style="color: #79a8ff;">   :PROPERTIES:</span>
<span style="color: #79a8ff;">   :Effort:   1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;">   :LOGBOOK:</span>
<span style="color: #79a8ff;">   CLOCK: [1970-01-01 Thu 01:00]--[1970-01-01 Thu 02:00] =&gt;  1:00</span>
<span style="color: #79a8ff;">   CLOCK: [1970-01-01 Thu 00:00]--[1970-01-01 Thu 01:00] =&gt;  1:00</span>
<span style="color: #79a8ff;">   :END:</span>
<span style="color: #79a8ff;">   "</span>))
    (<span style="color: #b6a0ff;">with-temp-buffer</span>
      (insert entry)
      (goto-char (point-min))
      (<span style="color: #b6a0ff;">should</span> (equal (jdb/org-standup--remaining-effort) 60.0)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org92a76f6" class="outline-4">
<h4 id="org92a76f6"><span class="section-number-4">2.23.4.</span> Interact with Google Calendar</h4>
<div class="outline-text-4" id="text-2-23-4">
<aside>
<div class="note" id="org5bff7ae">
<p>
<b><b>NOTE:</b></b> This is not currently in use.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">org-gcal</span>
<span style="color: #f78fe7;">:hook</span>
(org-gcal-after-update-entry-functions . my-org-gcal-set-effort)
<span style="color: #f78fe7;">:config</span>
(<span style="color: #b6a0ff;">setq</span> org-gcal-recurring-events-mode 'nested)
(<span style="color: #b6a0ff;">setq</span> org-gcal-remove-api-cancelled-events t)
(<span style="color: #b6a0ff;">setq</span> org-gcal-client-id (auth-source-pass-get <span style="color: #79a8ff;">"client_id"</span> <span style="color: #79a8ff;">"grafana/org-gcal"</span>))
(<span style="color: #b6a0ff;">setq</span> org-gcal-client-secret (auth-source-pass-get <span style="color: #79a8ff;">"client_secret"</span> <span style="color: #79a8ff;">"grafana/org-gcal"</span>))
(<span style="color: #b6a0ff;">setq</span> org-gcal-file-alist '((<span style="color: #79a8ff;">"jack.baldry@grafana.com"</span> .  <span style="color: #79a8ff;">"~/org/jack.baldry@grafana.com.org"</span>)))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">my-org-gcal-set-effort</span> (_calendar-id event _update-mode)
  <span style="color: #9ac8e0;">"Set Effort property based on EVENT if not already set."</span>
  (<span style="color: #b6a0ff;">when-let*</span> ((stime (plist-get (plist-get event <span style="color: #f78fe7;">:start</span>)
                                <span style="color: #f78fe7;">:dateTime</span>))
              (etime (plist-get (plist-get event <span style="color: #f78fe7;">:end</span>)
                                <span style="color: #f78fe7;">:dateTime</span>))
              (diff (float-time
                     (time-subtract (org-gcal--parse-calendar-time-string etime)
                                    (org-gcal--parse-calendar-time-string stime))))
              (minutes (floor (/ diff 60))))
    (<span style="color: #b6a0ff;">let</span> ((effort (org-entry-get (point) org-effort-property)))
      (<span style="color: #b6a0ff;">unless</span> effort
        (message <span style="color: #79a8ff;">"need to set effort - minutes %S"</span> minutes)
        (org-entry-put (point)
                       org-effort-property
                       (apply #'format <span style="color: #79a8ff;">"%d:%02d"</span> (cl-floor minutes 60))))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org80a2ff7" class="outline-3">
<h3 id="org80a2ff7"><span class="section-number-3">2.24.</span> Use Projectile for working with multiple code projects</h3>
<div class="outline-text-3" id="text-2-24">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">projectile</span>
  <span style="color: #f78fe7;">:after</span> transient
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> projectile-switch-project-action #'(<span style="color: #b6a0ff;">lambda</span>() (magit-status (projectile-acquire-root))))
  (<span style="color: #b6a0ff;">setq</span> projectile-completion-system 'ivy)

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/projectile-project-buffers</span> ()
    (projectile-project-buffers (projectile-acquire-root)))

  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">projectile-help</span> ()
    (<span style="color: #b6a0ff;">interactive</span>)
    <span style="color: #989898;">;; </span><span style="color: #989898;">From: https://stackoverflow.com/questions/3480173/show-keys-in-emacs-keymap-value</span>
    (<span style="color: #b6a0ff;">with-output-to-temp-buffer</span> <span style="color: #79a8ff;">"*keymap: projectile-command-map*"</span>
      (princ <span style="color: #79a8ff;">"projectile-command-map\n\n"</span>)
      (princ (substitute-command-keys <span style="color: #79a8ff;">"\\{</span><span style="color: #00d3d0;">projectile-command-map</span><span style="color: #79a8ff;">}"</span>))))
  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">projectile-search-transient</span> ()
    <span style="color: #9ac8e0;">"Transient for searching a projectile project"</span>
    [<span style="color: #79a8ff;">"Search with?"</span>
     (<span style="color: #79a8ff;">"r"</span> <span style="color: #79a8ff;">"Ripgrep"</span> projectile-ripgrep)])

  (<span style="color: #b6a0ff;">transient-define-prefix</span> <span style="color: #feacd0;">projectile-transient</span> ()
    <span style="color: #9ac8e0;">"Transient for projectile-mode-map"</span>
    [<span style="color: #79a8ff;">"Projectile actions"</span>
     (<span style="color: #79a8ff;">"c"</span> <span style="color: #79a8ff;">"Compile"</span> projectile-compile-project)
     (<span style="color: #79a8ff;">"e"</span> <span style="color: #79a8ff;">"Exit"</span> projectile-kill-buffers)
     (<span style="color: #79a8ff;">"f"</span> <span style="color: #79a8ff;">"Find"</span> projectile-find-file)
     (<span style="color: #79a8ff;">"p"</span> <span style="color: #79a8ff;">"Switch project"</span> projectile-switch-project)
     (<span style="color: #79a8ff;">"q"</span> <span style="color: #79a8ff;">"Switch open project"</span> projectile-switch-open-project)
     (<span style="color: #79a8ff;">"r"</span> <span style="color: #79a8ff;">"Replace"</span> projectile-replace)
     (<span style="color: #79a8ff;">"s"</span> <span style="color: #79a8ff;">"Search"</span> projectile-search-transient)
     (<span style="color: #79a8ff;">"S"</span> <span style="color: #79a8ff;">"Save"</span> projectile-save-project-buffers)
     (<span style="color: #79a8ff;">"x"</span> <span style="color: #79a8ff;">"Shell"</span> projectile-run-shell)
     (<span style="color: #79a8ff;">"?"</span> <span style="color: #79a8ff;">"Help"</span> projectile-help)])
  <span style="color: #f78fe7;">:bind</span>
  ((<span style="color: #f78fe7;">:map</span> projectile-mode-map (<span style="color: #79a8ff;">"C-c p"</span> . projectile-transient)))
  <span style="color: #f78fe7;">:init</span>
  (projectile-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org000cb43" class="outline-3">
<h3 id="org000cb43"><span class="section-number-3">2.25.</span> HTML</h3>
<div class="outline-text-3" id="text-2-25">
<p>
Functions for fetching and manipulating HTML.
</p>

<aside>
<div class="note" id="orgadfc405">
<p>
<b><b>NOTE:</b></b> Requires curl and kooky tools.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">dom</span>)

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/tag-for-url</span> (url tag)
  <span style="color: #9ac8e0;">"Fetch the HTML TAG for a URL.</span>
<span style="color: #9ac8e0;">TODO: strip off #edit from at least GDocs URLs as it breaks the request."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \nSTag: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((buffer (generate-new-buffer <span style="color: #79a8ff;">"title-for-url-as-kill"</span>)))
    (<span style="color: #b6a0ff;">with-temp-file</span> <span style="color: #79a8ff;">"/tmp/gdoc"</span>
      (<span style="color: #b6a0ff;">let</span> ((effective-url
             (shell-command-to-string (format <span style="color: #79a8ff;">"curl -A 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36' -Lsb &lt;(kooky -d %s -o /dev/stdout %s) -w %%{url_effective} -o /dev/null %s"</span>  (url-host (url-generic-parse-url url)) url url))))
        (shell-command (format <span style="color: #79a8ff;">"curl -Lb &lt;(kooky -d %s -o /dev/stdout) %s"</span> (url-host (url-generic-parse-url effective-url)) effective-url) (current-buffer))
        (dom-text (dom-by-tag (libxml-parse-html-region (point-min) (point-max)) tag))))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/title-for-url-as-kill</span> (url)
  <span style="color: #9ac8e0;">"Fetch the HTML title for a URL."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
  (kill-new (jdb/tag-for-url url 'title)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/title-for-url-as-kill-md</span> (url)
  <span style="color: #9ac8e0;">"Fetch the HTML title for a URL."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
  (kill-new (format <span style="color: #79a8ff;">"[%s](%s)"</span> (jdb/tag-for-url url 'title) url)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/h1-for-url-as-kill</span> (url)
  <span style="color: #9ac8e0;">"Fetch the first HTML H1 for a URL."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
  (kill-new (jdb/tag-for-url url 'h1)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/h1-for-url-as-kill-md</span> (url)
  <span style="color: #9ac8e0;">"Fetch the HTML h1 for a URL."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
  (kill-new (format <span style="color: #79a8ff;">"[%s](%s)"</span> (jdb/tag-for-url url 'h1) url)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ec434b" class="outline-3">
<h3 id="org2ec434b"><span class="section-number-3">2.26.</span> Edit browser text fields within Emacs</h3>
<div class="outline-text-3" id="text-2-26">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">atomic-chrome</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:commands</span> atomic-chrome-start-server
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> atomic-chrome-extension-type-list '(ghost-text))
  (atomic-chrome-start-server))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4b8da1" class="outline-3">
<h3 id="orga4b8da1"><span class="section-number-3">2.27.</span> Passwords</h3>
<div class="outline-text-3" id="text-2-27">
</div>
<div id="outline-container-org864c914" class="outline-4">
<h4 id="org864c914"><span class="section-number-4">2.27.1.</span> Start Pinentry service to have gpg commands interact with Emacs</h4>
<div class="outline-text-4" id="text-2-27-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">pinentry</span>
  <span style="color: #f78fe7;">:init</span>
  (setenv <span style="color: #79a8ff;">"INSIDE_EMACS"</span> (format <span style="color: #79a8ff;">"%s,comint"</span> emacs-version))
  (pinentry-start))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f2e9dd" class="outline-4">
<h4 id="org8f2e9dd"><span class="section-number-4">2.27.2.</span> Configure the Unix password manager pass as an auth source</h4>
<div class="outline-text-4" id="text-2-27-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">pass</span>
  <span style="color: #f78fe7;">:after</span> pinentry
  <span style="color: #f78fe7;">:init</span>
  (auth-source-pass-enable)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> auth-sources '(<span style="color: #79a8ff;">"~/.authinfo"</span> password-store)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec0e1eb" class="outline-3">
<h3 id="orgec0e1eb"><span class="section-number-3">2.28.</span> Email</h3>
<div class="outline-text-3" id="text-2-28">
<div class="org-src-container">
<pre class="src src-emacs-lisp">  <span style="color: #989898;">;;; </span><span style="color: #989898;">mue4e</span>
(<span style="color: #b6a0ff;">with-eval-after-load</span> 'f
  (<span style="color: #b6a0ff;">let</span> ((mu4epath
         (concat
          (f-dirname
           (file-truename
            (executable-find <span style="color: #79a8ff;">"mu"</span>)))
          <span style="color: #79a8ff;">"/../share/emacs/site-lisp/mu4e"</span>)))
    (<span style="color: #b6a0ff;">when</span> (<span style="color: #b6a0ff;">and</span>
           (string-prefix-p <span style="color: #79a8ff;">"/nix/store/"</span> mu4epath)
           (file-directory-p mu4epath))
      (add-to-list 'load-path mu4epath))))
(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">mu4e</span>
  <span style="color: #f78fe7;">:defer</span> t
  <span style="color: #f78fe7;">:commands</span> (mu4e mu4e-message mu4e-message-contact-field-matches)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">setq</span> mu4e-change-filenames-when-moving t)
  (<span style="color: #b6a0ff;">setq</span> mu4e-contexts
        `(,(make-mu4e-context
            <span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Grafana"</span>
            <span style="color: #f78fe7;">:enter-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Entering Grafana context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:leave-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Leaving Grafana context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:match-func</span> (<span style="color: #b6a0ff;">lambda</span> (msg)
                          (<span style="color: #b6a0ff;">when</span> msg
                            (<span style="color: #b6a0ff;">or</span> (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:to</span> <span style="color: #79a8ff;">"jack.baldry@grafana.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:from</span> <span style="color: #79a8ff;">"jack.baldry@grafana.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:cc</span> <span style="color: #79a8ff;">"jack.baldry@grafana.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:bcc</span> <span style="color: #79a8ff;">"jack.baldry@grafana.com"</span>))))
            <span style="color: #f78fe7;">:vars</span> '((user-full-name . <span style="color: #79a8ff;">"Jack Baldry"</span>)
                    (user-mail-address . <span style="color: #79a8ff;">"jack.baldry@grafana.com"</span>)
                    (mu4e-compose-signature . (format <span style="color: #79a8ff;">"Cheers,\n\njdb"</span>))
                    (mu4e-get-mail-command . <span style="color: #79a8ff;">"mbsync grafana"</span>)
                    (mu4e-maildir-shortcuts . ((<span style="color: #f78fe7;">:maildir</span> <span style="color: #79a8ff;">"/grafana/Archive"</span> <span style="color: #f78fe7;">:key</span> ?a)))
                    (mu4e-bookmarks .
                                    ((<span style="color: #f78fe7;">:name</span>  <span style="color: #79a8ff;">"Unread messages"</span>
                                             <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/grafana/Inbox AND flag:unread AND NOT flag:trashed"</span>
                                             <span style="color: #f78fe7;">:key</span> ?u)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Archive"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/grafana/Archive"</span>
                                            <span style="color: #f78fe7;">:key</span> ?a)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 2 days"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/grafana/Inbox AND date:2d..now AND NOT flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?t)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 7 days"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/grafana/Inbox AND date:7d..now AND NOT flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?w)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"This year"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/grafana/Inbox AND date:20220101..now AND NOT flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?y)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Deleted"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?d)))))
          ,(make-mu4e-context
            <span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"gmail"</span>
            <span style="color: #f78fe7;">:enter-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Entering gmail context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:leave-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Leaving gmail context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:match-func</span> (<span style="color: #b6a0ff;">lambda</span> (msg)
                          (<span style="color: #b6a0ff;">when</span> msg
                            (<span style="color: #b6a0ff;">or</span> (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:to</span> <span style="color: #79a8ff;">"jdbaldry@gmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:from</span> <span style="color: #79a8ff;">"jdbaldry@gmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:cc</span> <span style="color: #79a8ff;">"jdbaldry@gmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:bcc</span> <span style="color: #79a8ff;">"jdbaldry@gmail.com"</span>))))
            <span style="color: #f78fe7;">:vars</span> '((user-full-name . <span style="color: #79a8ff;">"Jack Baldry"</span>)
                    (user-mail-address . <span style="color: #79a8ff;">"jdbaldry@gmail.com"</span>)
                    (mu4e-compose-signature . (format <span style="color: #79a8ff;">"Cheers,\n\njdb"</span>))
                    (mu4e-get-mail-command . <span style="color: #79a8ff;">"mbsync gmail"</span>)
                    (mu4e-maildir-shortcuts . ((<span style="color: #f78fe7;">:maildir</span> <span style="color: #79a8ff;">"/gmail/Archive"</span> <span style="color: #f78fe7;">:key</span> ?a)))
                    (mu4e-bookmarks .
                                    ((<span style="color: #f78fe7;">:name</span>  <span style="color: #79a8ff;">"Unread messages"</span>
                                             <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/gmail/Inbox AND flag:unread AND NOT flag:trashed"</span>
                                             <span style="color: #f78fe7;">:key</span> ?u)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Archive"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/gmail/Archive"</span>
                                            <span style="color: #f78fe7;">:key</span> ?a)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 2 days"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/gmail/Inbox AND date:2d..now AND NOT flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?t)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 7 days"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/gmail/Inbox AND date:7d..now AND NOT flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?w)
                                     (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Deleted"</span>
                                            <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"flag:trashed"</span>
                                            <span style="color: #f78fe7;">:key</span> ?d)))))
          ,(make-mu4e-context
            <span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"fastmail"</span>
            <span style="color: #f78fe7;">:enter-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Entering fastmail context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:leave-func</span> (<span style="color: #b6a0ff;">lambda</span> ()
                          (mu4e-message <span style="color: #79a8ff;">"Leaving fastmail context"</span>)
                          (<span style="color: #b6a0ff;">when</span> (string-match-p (buffer-name (current-buffer)) <span style="color: #79a8ff;">"mu4e-main"</span>)
                            (revert-buffer)))
            <span style="color: #f78fe7;">:match-func</span> (<span style="color: #b6a0ff;">lambda</span> (msg)
                          (<span style="color: #b6a0ff;">when</span> msg
                            (<span style="color: #b6a0ff;">or</span> (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:to</span> <span style="color: #79a8ff;">"jdbaldry@fastmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:from</span> <span style="color: #79a8ff;">"jdbaldry@fastmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:cc</span> <span style="color: #79a8ff;">"jdbaldry@fastmail.com"</span>)
                                (mu4e-message-contact-field-matches msg <span style="color: #f78fe7;">:bcc</span> <span style="color: #79a8ff;">"jdbaldry@fastmail.com"</span>))))
            <span style="color: #f78fe7;">:vars</span> '((user-full-name . <span style="color: #79a8ff;">"Jack Baldry"</span>)
                    (user-mail-address . <span style="color: #79a8ff;">"jdbaldry@fastmail.com"</span>)
                    (mu4e-compose-signature . (format <span style="color: #79a8ff;">"Cheers,\n\njdb"</span>))
                    (mu4e-get-mail-command . <span style="color: #79a8ff;">"mbsync fastmail"</span>)
                    (mu4e-maildir-shortcuts . ((<span style="color: #f78fe7;">:maildir</span> <span style="color: #79a8ff;">"/fastmail/Archive"</span> <span style="color: #f78fe7;">:key</span> ?a)))
                    (mu4e-bookmarks . ((<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Unread messages"</span>
                                              <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/fastmail/Inbox AND flag:unread AND NOT flag:trashed"</span>
                                              <span style="color: #f78fe7;">:key</span> ?u)
                                       (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Archive"</span>
                                              <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/fastmail/Archive"</span>
                                              <span style="color: #f78fe7;">:key</span> ?a)
                                       (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 2 days"</span>
                                              <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/fastmail/Inbox AND date:2d..now AND NOT flag:trashed"</span>
                                              <span style="color: #f78fe7;">:key</span> ?t)
                                       (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Last 7 days"</span>
                                              <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"maildir:/fastmail/Inbox AND date:7d..now AND NOT flag:trashed"</span>
                                              <span style="color: #f78fe7;">:key</span> ?w)
                                       (<span style="color: #f78fe7;">:name</span> <span style="color: #79a8ff;">"Deleted"</span>
                                              <span style="color: #f78fe7;">:query</span> <span style="color: #79a8ff;">"flag:trashed"</span>
                                              <span style="color: #f78fe7;">:key</span> ?d)))))))
  (<span style="color: #b6a0ff;">setq</span> send-mail-function 'sendmail-send-it)
  (<span style="color: #b6a0ff;">setq</span> sendmail-program (executable-find <span style="color: #79a8ff;">"msmtp"</span>))
  (<span style="color: #b6a0ff;">setq</span> mu4e-attachment-dir <span style="color: #79a8ff;">"~/Downloads"</span>)
  (<span style="color: #b6a0ff;">setq</span> mu4e-get-mail-command <span style="color: #79a8ff;">"mbsync -a"</span>)
  (<span style="color: #b6a0ff;">setq</span> mu4e-headers-date-format <span style="color: #79a8ff;">"%F"</span>)
  (<span style="color: #b6a0ff;">setq</span> mu4e-headers-time-format <span style="color: #79a8ff;">"%H:%M:%S"</span>)
  (<span style="color: #b6a0ff;">setq</span> mu4e-headers-include-related nil)
  (<span style="color: #b6a0ff;">setq</span> mu4e-html2text-command <span style="color: #79a8ff;">"iconv -c -t utf-8 | pandoc -f html -t plain"</span>)
  (add-to-list 'mu4e-view-actions '(<span style="color: #79a8ff;">"View in browser"</span> . mu4e-action-view-in-browser) t)
  (<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">ace-link</span>
    <span style="color: #f78fe7;">:defer</span> t
    <span style="color: #f78fe7;">:config</span>
    (add-to-list 'mu4e-view-actions `(<span style="color: #79a8ff;">"Open link"</span> . ,(<span style="color: #b6a0ff;">lambda</span> (_) (ace-link-mu4e))) t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb76d29e" class="outline-3">
<h3 id="orgb76d29e"><span class="section-number-3">2.29.</span> Jump to a word</h3>
<div class="outline-text-3" id="text-2-29">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">avy</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:bind</span> ((<span style="color: #79a8ff;">"M-s"</span> . avy-goto-word-1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org752d36d" class="outline-3">
<h3 id="org752d36d"><span class="section-number-3">2.30.</span> Capture a screenshot</h3>
<div class="outline-text-3" id="text-2-30">
<aside>
<div class="note" id="org12f6f16">
<p>
<b><b>NOTE:</b></b> Requires `grimshot` tool.
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/scrot</span> ()
  <span style="color: #9ac8e0;">"Capture a screenshot and store it in the ~/screenshots/ directory."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (start-process-shell-command <span style="color: #79a8ff;">"grimshot"</span> nil <span style="color: #79a8ff;">"grimshot save window ${HOME}/screenshots/$(date '</span><span style="color: #00bcff;">+%Y-%m-%dT%H:%M:%S</span><span style="color: #79a8ff;">').png"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d75893" class="outline-3">
<h3 id="org1d75893"><span class="section-number-3">2.31.</span> Regular expressions for URLs</h3>
<div class="outline-text-3" id="text-2-31">
<p>
Regular expressions for HTTP URLs constructed to be match all the nonterminals defined in the BNF in <a href="https://datatracker.ietf.org/doc/html/rfc1738#section-5">RFC1738</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">rx-define</span> alphadigit alphanumeric)
(<span style="color: #b6a0ff;">rx-define</span> digits (+ digit))
(<span style="color: #b6a0ff;">rx-define</span> domainlabel (| alphadigit (* alphadigit (? (| alphadigit <span style="color: #79a8ff;">"-"</span>)) alphadigit)))
(<span style="color: #b6a0ff;">rx-define</span> toplabel (| alpha (* alpha (? (| alphadigit <span style="color: #79a8ff;">"-"</span>)) alphadigit)))
(<span style="color: #b6a0ff;">rx-define</span> hostname (seq (* domainlabel <span style="color: #79a8ff;">"."</span>) toplabel))
(<span style="color: #b6a0ff;">rx-define</span> hostnumber (seq digits <span style="color: #79a8ff;">"."</span> digits <span style="color: #79a8ff;">"."</span> digits <span style="color: #79a8ff;">"."</span> digits))
(<span style="color: #b6a0ff;">rx-define</span> host (| hostname hostnumber))
(<span style="color: #b6a0ff;">rx-define</span> port digits)
(<span style="color: #b6a0ff;">rx-define</span> hostport (seq host (? <span style="color: #79a8ff;">":"</span> port)))
(<span style="color: #b6a0ff;">rx-define</span> safe (any <span style="color: #79a8ff;">"$-_.+"</span>))
(<span style="color: #b6a0ff;">rx-define</span> extra (any <span style="color: #79a8ff;">"!*',()"</span>))
(<span style="color: #b6a0ff;">rx-define</span> unreserved (| alpha digit safe extra))
(<span style="color: #b6a0ff;">rx-define</span> escape (seq <span style="color: #79a8ff;">"%"</span> hex hex))
(<span style="color: #b6a0ff;">rx-define</span> uchar (| unreserved escape))
(<span style="color: #b6a0ff;">rx-define</span> hsegment (* (| uchar (any <span style="color: #79a8ff;">";:@&amp;="</span>))))
(<span style="color: #b6a0ff;">rx-define</span> hpath (seq hsegment (* <span style="color: #79a8ff;">"/"</span> hsegment)))
(<span style="color: #b6a0ff;">rx-define</span> search (* (| uchar (any <span style="color: #79a8ff;">";:@&amp;="</span>))))
(<span style="color: #b6a0ff;">rx-define</span> httpurl (seq <span style="color: #79a8ff;">"http://"</span> hostport (? <span style="color: #79a8ff;">"/"</span> hpath (? <span style="color: #79a8ff;">"?"</span> search))))
(<span style="color: #b6a0ff;">rx-define</span> httpsurl (seq <span style="color: #79a8ff;">"https://"</span> hostport (? <span style="color: #79a8ff;">"/"</span> hpath (? <span style="color: #79a8ff;">"?"</span> search))))
<span style="color: #989898;">;; </span><span style="color: #989898;">urlish matches HTTPS or HTTP URLs that are just missing a scheme.</span>
(<span style="color: #b6a0ff;">rx-define</span> urlish (seq (? (seq <span style="color: #79a8ff;">"http"</span> (? <span style="color: #79a8ff;">"s"</span>) <span style="color: #79a8ff;">"://"</span>)) hostport (? <span style="color: #79a8ff;">"/"</span> hpath (? <span style="color: #79a8ff;">"?"</span> search))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d14f7b" class="outline-3">
<h3 id="org3d14f7b"><span class="section-number-3">2.32.</span> Conveniently browse to URLs</h3>
<div class="outline-text-3" id="text-2-32">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq-default</span> browse-url-new-window-flag t)
(<span style="color: #b6a0ff;">setq</span> browse-url-browser-function 'browse-url-chromium)

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/chr</span> (incognito url)
  <span style="color: #9ac8e0;">"Start a chromium process at URL.</span>
<span style="color: #9ac8e0;">If INCOGNITO is non-nil, start the chromium incognito."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"P\nsURL: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((browse-url-chromium-arguments (<span style="color: #b6a0ff;">if</span> incognito (cons <span style="color: #79a8ff;">"--incognito"</span> browse-url-chromium-arguments) browse-url-chromium-arguments)))
    (browse-url-chromium url)))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">cl-lib</span>)
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/chr-open</span> (url buffer-regexp)
  <span style="color: #9ac8e0;">"Open the buffer matching BUFFER-REGEXP or a new Chromium window for URL."</span>
  (<span style="color: #b6a0ff;">let</span> ((meet-buffers (cl-remove-if-not (<span style="color: #b6a0ff;">lambda</span> (buffer)  (string-match-p buffer-regexp (buffer-name buffer))) (buffer-list))))
    (<span style="color: #b6a0ff;">if</span> (&gt; (length meet-buffers) 0)
        (switch-to-buffer (buffer-name (car meet-buffers)) 'force-same-window)
      (browse-url url))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/meet</span> () <span style="color: #9ac8e0;">"Start a Google Meet."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/chr-open <span style="color: #79a8ff;">"https://meet.new"</span> <span style="color: #79a8ff;">"Meet"</span>))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/whatsapp</span> () <span style="color: #9ac8e0;">"Open Whatsapp."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/chr-open <span style="color: #79a8ff;">"https://web.whatsapp.com"</span> <span style="color: #79a8ff;">"Whatsapp"</span>))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/g-calendar</span> () <span style="color: #9ac8e0;">"Open Google Calendar."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/chr-open <span style="color: #79a8ff;">"https://calendar.google.com"</span> <span style="color: #79a8ff;">"Grafana Labs - Calendar"</span>))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-github-notifications</span> () <span style="color: #9ac8e0;">"Open GitHub notifications."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/chr-open <span style="color: #79a8ff;">"https://github.com/notifications"</span> <span style="color: #79a8ff;">"Notifications"</span>))
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-github-project</span> () <span style="color: #9ac8e0;">"Open my work GitHub project."</span> (<span style="color: #b6a0ff;">interactive</span>) (jdb/chr-open <span style="color: #79a8ff;">"https://github.com/orgs/grafana/projects/279/views/1"</span> <span style="color: #79a8ff;">"jdb"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/yt</span> (query)
  <span style="color: #9ac8e0;">"Search YouTube with QUERY."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sQuery: \n"</span>)
  (jdb/chr t (concat <span style="color: #79a8ff;">"https://youtube.com/results?search_query="</span> (replace-regexp-in-string <span style="color: #79a8ff;">" "</span> <span style="color: #79a8ff;">"+"</span> query))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/yt-local</span> (url)
  <span style="color: #9ac8e0;">"Convert a YouTube URL into one for the local player."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sURL: \n"</span>)
  (string-match (<span style="color: #b6a0ff;">rx</span> (seq <span style="color: #79a8ff;">"v="</span> (group (= 11 (any alphanumeric))))) url)
  (kill-new (format <span style="color: #79a8ff;">"file:///home/jdb/youtube.html?v=%s&amp;t=0"</span> (match-string-no-properties 1 url))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/ddg</span> (incognito query)
  <span style="color: #9ac8e0;">"Search DuckDuckGo for QUERY.</span>
<span style="color: #9ac8e0;">IF INCOGNITO is non-nil, search incognito."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"P\nsQuery: \n"</span>)
  (jdb/chr incognito (concat <span style="color: #79a8ff;">"https://duckduckgo.com/?q="</span> (replace-regexp-in-string <span style="color: #79a8ff;">" "</span> <span style="color: #79a8ff;">"+"</span> query))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/search-go</span> (package)
  <span style="color: #9ac8e0;">"Search for PACKAGE on https://pkg.go.dev."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sPackage: \n"</span>)
  (browse-url (concat <span style="color: #79a8ff;">"https://pkg.go.dev/search?q="</span> package)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/search-nixos</span> (package)
  <span style="color: #9ac8e0;">"Search for PACKAGE in NixOS packages."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sPackage: \n"</span>)
  (browse-url (concat <span style="color: #79a8ff;">"https://search.nixos.org/packages?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query="</span> package)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-pulls-on-github</span> (org repo)
  <span style="color: #9ac8e0;">"Browse my Pull Requests on GitHub for a specific ORG and REPO."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sOrg: \nsRepository: \n"</span>)
  (browse-url (format <span style="color: #79a8ff;">"https://github.com/%s/%s/pulls/@me"</span> org repo)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-github</span> (org)
  <span style="color: #9ac8e0;">"Browse the current file in GitHub.</span>
<span style="color: #9ac8e0;">ORG is the Github repository owner."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sOrg: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((url <span style="color: #79a8ff;">"https://github.com"</span>)
        (repo (car (last (delete <span style="color: #79a8ff;">""</span> (split-string (projectile-project-root) <span style="color: #79a8ff;">"/"</span>)))))
        (ref (shell-command-to-string <span style="color: #79a8ff;">"git rev-parse HEAD"</span>))
        (file (string-remove-prefix (projectile-project-root) (buffer-file-name)))
        (line (line-number-at-pos)))
    (browse-url (format <span style="color: #79a8ff;">"%s/%s/%s/tree/%s/%s#L%s"</span> url org repo ref file line))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-aoc</span> (year day)
  <span style="color: #9ac8e0;">"Browse the Advent of Code puzzle corresponding to YEAR and DAY."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sYear: \nsDay: \n"</span>)
  (browse-url (format <span style="color: #79a8ff;">"https://adventofcode.com/%s/day/%s"</span> year day)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-geeksforgeeks</span> ()
  <span style="color: #9ac8e0;">"Browse the geeksforgeeks.org problems page."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (browse-url <span style="color: #79a8ff;">"https://practice.geeksforgeeks.org/explore?page=1&amp;status[]=unsolved&amp;sortBy=difficulty&amp;utm_source=auth&amp;utm_medium=profile&amp;utm_campaign=empty-data"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-issue</span> (org repo issue)
  <span style="color: #9ac8e0;">"Browse the GitHub issue number ISSUE for ORG/REPO."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sOrg: \nsRepo: \nnIssue: \n"</span>)
  (browse-url (format <span style="color: #79a8ff;">"https://github.com/%s/%s/issues/%s"</span> org repo issue)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/browse-zendesk</span>(id)
  <span style="color: #9ac8e0;">"Browse a Zendesk ticket.  ID is the Zendesk ticket number."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sID: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((url <span style="color: #79a8ff;">"https://grafana.zendesk.com/agent/tickets"</span>))
    (browse-url (format <span style="color: #79a8ff;">"%s/%s"</span> url id))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/docs-home-manager</span> ()
  <span style="color: #9ac8e0;">"Open the home-manager documentation."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (browse-url <span style="color: #79a8ff;">"https://nix-community.github.io/home-manager/"</span>))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/soccercatch</span> ()
  <span style="color: #9ac8e0;">"Browse to soccercatch.com."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/chr t <span style="color: #79a8ff;">"https://soccercatch.com"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ecf40e" class="outline-3">
<h3 id="org8ecf40e"><span class="section-number-3">2.33.</span> Manage brightness</h3>
<div class="outline-text-3" id="text-2-33">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">f</span>)
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/brightness</span> (percentage)
  <span style="color: #9ac8e0;">"Adjust the brightness to PERCENTAGE."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"p"</span>)
  (<span style="color: #b6a0ff;">let*</span> ((backlight-path <span style="color: #79a8ff;">"/sys/class/backlight/intel_backlight"</span>)
         (path-join (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;rest</span> paths) (string-join paths <span style="color: #79a8ff;">"/"</span>)))
         (max-brightness-file (funcall path-join backlight-path <span style="color: #79a8ff;">"max_brightness"</span>))
         (max-brightness (string-to-number (f-read-text max-brightness-file)))
         (brightness-file (funcall path-join backlight-path <span style="color: #79a8ff;">"brightness"</span>))
         (brightness (* percentage (/ max-brightness 100))))
    (start-process-shell-command <span style="color: #79a8ff;">"brightness"</span> nil
                                 (format <span style="color: #79a8ff;">"tee %s &lt;&lt;&lt;%s"</span> brightness-file brightness))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1664b15" class="outline-3">
<h3 id="org1664b15"><span class="section-number-3">2.34.</span> Manage sound</h3>
<div class="outline-text-3" id="text-2-34">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/amixer-message</span> ()
  <span style="color: #9ac8e0;">"Output the current volume as a message."</span>
  (message <span style="color: #79a8ff;">"%s"</span> (shell-command-to-string <span style="color: #79a8ff;">"pactl get-sink-volume @DEFAULT_SINK@"</span>)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/amixer-set-vol</span> (vol)
  <span style="color: #9ac8e0;">"Set the volume to VOL percent."</span>
  (shell-command (format <span style="color: #79a8ff;">"pactl set-sink-volume @DEFAULT_SINK@ %s%%"</span> vol)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/amixer-mute</span> ()
  <span style="color: #9ac8e0;">"Mute sound."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (jdb/amixer-set-vol 0)
  (jdb/amixer-message))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/amixer-unmute</span> (vol)
  <span style="color: #9ac8e0;">"Set sound level to 100% if VOL is nil otherwise, set to the value of VOL."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"P"</span>)
  (jdb/amixer-set-vol (<span style="color: #b6a0ff;">or</span> vol 100))
  (jdb/amixer-message))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb9682d" class="outline-3">
<h3 id="orgeb9682d"><span class="section-number-3">2.35.</span> Goto for compilation-mode errors</h3>
<div class="outline-text-3" id="text-2-35">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">compile</span>
  <span style="color: #f78fe7;">:config</span>
  (add-to-list 'compilation-error-regexp-alist 'markdownlint-cli)
  (add-to-list 'compilation-error-regexp-alist-alist
               '(markdownlint-cli .
                                  (<span style="color: #79a8ff;">"^</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[</span><span style="color: #ff5f59; font-weight: bold;">^</span><span style="color: #79a8ff;">:]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;"> .*$"</span>
                                   1 2 3)))
  (add-to-list 'compilation-error-regexp-alist 'monkeyc)
  (add-to-list 'compilation-error-regexp-alist-alist
               '(monkeyc .
                         (<span style="color: #79a8ff;">"^ERROR: [</span><span style="color: #ff5f59; font-weight: bold;">^</span><span style="color: #79a8ff;">:]+: </span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[</span><span style="color: #ff5f59; font-weight: bold;">^</span><span style="color: #79a8ff;">:]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">,</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">: .*$"</span>
                          1 2 3)))
  (add-to-list 'compilation-error-regexp-alist 'doc-validator)
  (add-to-list 'compilation-error-regexp-alist-alist
               '(doc-validator .
                               (<span style="color: #79a8ff;">"^ERROR: </span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[</span><span style="color: #ff5f59; font-weight: bold;">^</span><span style="color: #79a8ff;">:]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;"> .*$"</span>
                                1 2 3))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2bf85f" class="outline-3">
<h3 id="orgc2bf85f"><span class="section-number-3">2.36.</span> Snippets with yasnippet</h3>
<div class="outline-text-3" id="text-2-36">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">yasnippet</span> <span style="color: #f78fe7;">:ensure</span> t <span style="color: #f78fe7;">:config</span> (yas-global-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org699f092" class="outline-3">
<h3 id="org699f092"><span class="section-number-3">2.37.</span> Use rx in re-builder</h3>
<div class="outline-text-3" id="text-2-37">
<p>
From <a href="https://www.masteringemacs.org/article/re-builder-interactive-regexp-builder">https://www.masteringemacs.org/article/re-builder-interactive-regexp-builder</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">re-builder</span> <span style="color: #f78fe7;">:config</span> (<span style="color: #b6a0ff;">setq</span> reb-re-syntax 'rx))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fc105f" class="outline-3">
<h3 id="org3fc105f"><span class="section-number-3">2.38.</span> Format everything</h3>
<div class="outline-text-3" id="text-2-38">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">format-all</span>
  <span style="color: #f78fe7;">:ensure</span> t
  <span style="color: #f78fe7;">:hook</span>
  (prog-mode . format-all-mode)
  (markdown-mode . format-all-mode)
  (format-all-mode . format-all-ensure-formatter))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4471160" class="outline-3">
<h3 id="org4471160"><span class="section-number-3">2.39.</span> NixOS</h3>
<div class="outline-text-3" id="text-2-39">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/nixos-flake-update</span> (directory)
  <span style="color: #9ac8e0;">"Update the system configuration flake.</span>
<span style="color: #9ac8e0;">DIRECTORY configures which directory to update the flake in."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sDirectory: \n"</span>)
  (<span style="color: #b6a0ff;">let</span> ((compilation-buffer-name-function (<span style="color: #b6a0ff;">lambda</span> (_) <span style="color: #9ac8e0;">"*jdb/nixos-flake-update*"</span>)))
    (compile (format <span style="color: #79a8ff;">"cd %s &amp;&amp; nix flake update"</span> (<span style="color: #b6a0ff;">if</span> (string-blank-p directory)  <span style="color: #79a8ff;">"~/.config/nixos"</span> directory)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/nixos-rebuild</span> ()
  <span style="color: #9ac8e0;">"Rebuild and switch to the new generation."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((compilation-buffer-name-function (<span style="color: #b6a0ff;">lambda</span> (_) <span style="color: #9ac8e0;">"*jdb/nixos-rebuild*"</span>)))
    <span style="color: #989898;">;; </span><span style="color: #989898;">nix flake lock --update-input input</span>
    (compile <span style="color: #79a8ff;">"cd ~/.config/nixos &amp;&amp; nix flake lock --update-input xinput_exporter &amp;&amp; sudo nixos-rebuild switch --flake ~/.config/nixos"</span> t)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/nix-collect-garbage</span> ()
  <span style="color: #9ac8e0;">"Collect Nix garbage."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((compilation-buffer-name-function (<span style="color: #b6a0ff;">lambda</span> (_) <span style="color: #9ac8e0;">"*jdb/nix-collect-garbage*"</span>)))
    (compile <span style="color: #79a8ff;">"sudo nix-collect-garbage"</span> t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7699cb3" class="outline-3">
<h3 id="org7699cb3"><span class="section-number-3">2.40.</span> Git</h3>
<div class="outline-text-3" id="text-2-40">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/co-authored-by--grep-authors</span> (regexp)
  <span style="color: #9ac8e0;">"Find all authors in the git log that match REGEXP."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sRegexp: \n"</span>)
  (<span style="color: #b6a0ff;">with-current-buffer</span> (generate-new-buffer <span style="color: #79a8ff;">"grep-authors"</span>)
    (switch-to-buffer (current-buffer))
    (start-process-shell-command <span style="color: #79a8ff;">"grep-authors"</span> (current-buffer) (format <span style="color: #79a8ff;">"git log | grep %s | sort -u"</span> regexp))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/co-authored-by</span> ()
  <span style="color: #9ac8e0;">"Add a Co-authored-by line to a commit message."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (<span style="color: #b6a0ff;">let</span> ((tag <span style="color: #79a8ff;">"Co-authored-by: "</span>))
    (ivy-read tag
              (<span style="color: #b6a0ff;">lambda</span> (<span style="color: #6ae4b9;">&amp;rest</span> _) jdb/co-authored-by--collection)
              <span style="color: #f78fe7;">:action</span> (<span style="color: #b6a0ff;">lambda</span> (author)
                        (customize-set-variable 'jdb/co-authored-by--collection
                                                (add-to-list 'jdb/co-authored-by--collection author))
                        (customize-save-customized)
                        (insert (concat tag author)))
              <span style="color: #f78fe7;">:caller</span> 'co-authored-by)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb65133d" class="outline-3">
<h3 id="orgb65133d"><span class="section-number-3">2.41.</span> Speed up garbage collection</h3>
<div class="outline-text-3" id="text-2-41">
<p>
Make gc pauses faster by decreasing the threshold.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">setq</span> gc-cons-threshold (* 2 1000 1000))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb5108e" class="outline-3">
<h3 id="orgeb5108e"><span class="section-number-3">2.42.</span> Miscellany</h3>
<div class="outline-text-3" id="text-2-42">
</div>
<div id="outline-container-org698d976" class="outline-4">
<h4 id="org698d976"><span class="section-number-4">2.42.1.</span> Convert a string to Slack alphabet emojis.</h4>
<div class="outline-text-4" id="text-2-42-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;; </span><span style="color: #989898;">(message (jdb/string-to-alphabet-emoji "test:smile:test" nil))</span>
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/string-to-alphabet-emoji</span> (str <span style="color: #6ae4b9;">&amp;optional</span> white?)
  <span style="color: #9ac8e0;">"Display the message STR as Slack alphabet emoji.</span>
<span style="color: #9ac8e0;">WHITE? represents whether the character should be yellow (nil)</span>
<span style="color: #9ac8e0;">or white (integer value)."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sMessage: \nP"</span>)

  <span style="color: #989898;">;; </span><span style="color: #989898;">Taken from: https://emacs.stackexchange.com/questions/7148/get-all-regexp-matches-in-buffer-as-a-list</span>
  (<span style="color: #b6a0ff;">let</span> ((find-matches (<span style="color: #b6a0ff;">lambda</span> (regexp str)
                        <span style="color: #9ac8e0;">"Return a list of all matches of REGEXP in STR."</span>
                        (<span style="color: #b6a0ff;">let</span> ((pos 0) matches)
                          (<span style="color: #b6a0ff;">while</span> (string-match regexp str pos)
                            (<span style="color: #b6a0ff;">push</span> (match-string 0 str) matches)
                            (<span style="color: #b6a0ff;">setq</span> pos (match-end 0)))
                          (reverse matches)))))
    (kill-new (message (mapconcat
                        (<span style="color: #b6a0ff;">lambda</span> (token)
                          (<span style="color: #b6a0ff;">let</span> ((color (<span style="color: #b6a0ff;">if</span> white? <span style="color: #79a8ff;">"yellow"</span> <span style="color: #79a8ff;">"white"</span>))
                                (emoji? (&lt; 1 (length token))))
                            (<span style="color: #b6a0ff;">cond</span> (emoji? token)
                                  ((<span style="color: #b6a0ff;">and</span> (org-string&lt;= <span style="color: #79a8ff;">"A"</span> token)
                                        (org-string&lt;= token <span style="color: #79a8ff;">"z"</span>))
                                   (format <span style="color: #79a8ff;">":alphabet-%s-%s:"</span>
                                           color
                                           (downcase token)))
                                  ((string-equal <span style="color: #79a8ff;">"!"</span> token) (format <span style="color: #79a8ff;">":alphabet-%s-exclamation:"</span> color))
                                  ((string-equal <span style="color: #79a8ff;">"?"</span> token) (format <span style="color: #79a8ff;">":alphabet-%s-question:"</span> color))
                                  ((string-equal <span style="color: #79a8ff;">"@"</span> token) (format <span style="color: #79a8ff;">":alphabet-%s-at:"</span> color))
                                  ((string-equal <span style="color: #79a8ff;">"#"</span> token) (format <span style="color: #79a8ff;">":alphabet-%s-hash:"</span> color))
                                  ((string-equal <span style="color: #79a8ff;">" "</span> token) <span style="color: #79a8ff;">"   "</span>)
                                  (t token))))
                        (funcall find-matches <span style="color: #79a8ff;">"</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">:[a-z-_+-]+:</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">|</span><span style="color: #79a8ff;">.</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">"</span> str)
                        <span style="color: #79a8ff;">""</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d9c4dc" class="outline-4">
<h4 id="org5d9c4dc"><span class="section-number-4">2.42.2.</span> Apply an RCS formatted patch to a buffer</h4>
<div class="outline-text-4" id="text-2-42-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;; </span><span style="color: #989898;">Taken from https://github.com/dominikh/go-mode.el/blob/08aa90d52f0e7d2ad02f961b554e13329672d7cb/go-mode.el#L1852-L1894</span>
<span style="color: #989898;">;; </span><span style="color: #989898;">Adjusted to avoid relying on cl-libs or other go-mode internal functions.</span>
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/apply-rcs-patch</span> (patch-buffer)
  <span style="color: #9ac8e0;">"Apply an RCS-formatted diff from PATCH-BUFFER to the current buffer."</span>
  (<span style="color: #b6a0ff;">let</span> ((target-buffer (current-buffer))
        <span style="color: #989898;">;; </span><span style="color: #989898;">Relative offset between buffer line numbers and line numbers</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">in patch.</span>
        <span style="color: #989898;">;;</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">Line numbers in the patch are based on the source file, so</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">we have to keep an offset when making changes to the</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">buffer.</span>
        <span style="color: #989898;">;;</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">Appending lines decrements the offset (possibly making it</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">negative), deleting lines increments it. This order</span>
        <span style="color: #989898;">;; </span><span style="color: #989898;">simplifies the forward-line invocations.</span>
        (line-offset 0)
        (column (current-column)))
    (<span style="color: #b6a0ff;">save-excursion</span>
      (<span style="color: #b6a0ff;">with-current-buffer</span> patch-buffer
        (goto-char (point-min))
        (<span style="color: #b6a0ff;">while</span> (not (eobp))
          (<span style="color: #b6a0ff;">unless</span> (looking-at <span style="color: #79a8ff;">"^</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[ad]</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;"> </span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">(</span><span style="color: #79a8ff;">[0-9]+</span><span style="color: #feacd0;">\\</span><span style="color: #00c06f;">)</span><span style="color: #79a8ff;">"</span>)
            (<span style="color: #fec43f;">error</span> <span style="color: #79a8ff;">"Invalid rcs patch or internal error in jdb/apply-rcs-patch"</span>))
          (forward-line)
          (<span style="color: #b6a0ff;">let</span> ((action (match-string 1))
                (from (string-to-number (match-string 2)))
                (len  (string-to-number (match-string 3))))
            (<span style="color: #b6a0ff;">cond</span>
             ((equal action <span style="color: #79a8ff;">"a"</span>)
              (<span style="color: #b6a0ff;">let</span> ((start (point)))
                (forward-line len)
                (<span style="color: #b6a0ff;">let</span> ((text (buffer-substring start (point))))
                  (<span style="color: #b6a0ff;">with-current-buffer</span> target-buffer
                    (<span style="color: #b6a0ff;">setq</span> line-offset (- line-offset len))
                    (goto-char (point-min))
                    (forward-line (- from len line-offset))
                    (insert text)))))
             ((equal action <span style="color: #79a8ff;">"d"</span>)
              (<span style="color: #b6a0ff;">with-current-buffer</span> target-buffer
                (goto-char (point-min))
                (forward-line (1- (- from line-offset)))
                (<span style="color: #b6a0ff;">setq</span> line-offset (+ line-offset len))
                (<span style="color: #b6a0ff;">dotimes</span> (_ len)
                  (delete-region (point) (<span style="color: #b6a0ff;">save-excursion</span> (move-end-of-line 1) (point)))
                  (delete-char 1))))
             (t
              (<span style="color: #fec43f;">error</span> <span style="color: #79a8ff;">"Invalid rcs patch or internal error in jdb/apply-rcs-patch"</span>)))))))
    (move-to-column column)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1886c1" class="outline-4">
<h4 id="orgb1886c1"><span class="section-number-4">2.42.3.</span> Implement watch buffer</h4>
<div class="outline-text-4" id="text-2-42-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/watch</span> (command n)
  <span style="color: #9ac8e0;">"Run a specific shell COMMAND every N seconds."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"sCommand:\nnEvery:\n"</span>)
  (<span style="color: #b6a0ff;">let*</span> ((buffer (generate-new-buffer (format <span style="color: #79a8ff;">"watch: %s"</span> command)))
         (updated (get-buffer-create (format <span style="color: #79a8ff;">"next %s"</span> command)))
         <span style="color: #989898;">;; </span><span style="color: #989898;">TODO: Remove timer after killing buffer?</span>
         (timer (run-at-time n n
                             (<span style="color: #b6a0ff;">lambda</span> (buffer updated command)
                               (<span style="color: #b6a0ff;">with-current-buffer</span> buffer
                                 <span style="color: #989898;">;; </span><span style="color: #989898;">TODO: Avoid bringing up `</span><span style="color: #00bcff;">updated</span><span style="color: #989898;">' buffer.</span>
                                 (shell-command command updated)
                                 (replace-buffer-contents updated)))
                             buffer updated command)))
    (switch-to-buffer buffer)
    (shell-command command (current-buffer))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org00e1b0a" class="outline-4">
<h4 id="org00e1b0a"><span class="section-number-4">2.42.4.</span> Caps lock minor mode</h4>
<div class="outline-text-4" id="text-2-42-4">
<aside>
<div class="note" id="org8df1ed7">
<p>
<b><b>NOTE:</b></b> It can be fun to disable this mode.  Don't forget about `\\[downcase-word]'!
</p>

</div>
</aside>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defvar</span> <span style="color: #00d3d0;">caps-lock-mode-map</span>
  (<span style="color: #b6a0ff;">let</span> ((map (make-sparse-keymap)))
    (mapc (<span style="color: #b6a0ff;">lambda</span> (char) (keymap-set map (char-to-string char) 'caps-lock-mode-self-insert-command))
          <span style="color: #79a8ff;">"abcdefghijklmnopqrstuvwxyz"</span>)
    map))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">caps-lock-mode-self-insert-command</span> (<span style="color: #6ae4b9;">&amp;optional</span> n)
  <span style="color: #9ac8e0;">"Like `</span><span style="color: #00bcff;">self-insert-command</span><span style="color: #9ac8e0;">', but upcase the typed character.</span>
<span style="color: #9ac8e0;">The numeric prefix argument N says how many times to repeat the insertion."</span>
  (<span style="color: #b6a0ff;">interactive</span> <span style="color: #79a8ff;">"p"</span>)
  (insert-char (upcase last-command-event) n))

(<span style="color: #b6a0ff;">define-minor-mode</span> <span style="color: #feacd0;">caps-lock-mode</span>
  <span style="color: #9ac8e0;">"Insert all latin alphabet characters as caps.</span>
<span style="color: #9ac8e0;">It can be fun to disable this mode.  Don't forget about `\\[</span><span style="color: #00bcff;">downcase-word</span><span style="color: #9ac8e0;">]'!"</span>
  <span style="color: #f78fe7;">:global</span> t <span style="color: #f78fe7;">:lighter</span> <span style="color: #79a8ff;">" CAPS-LOCK"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org970a51f" class="outline-4">
<h4 id="org970a51f"><span class="section-number-4">2.42.5.</span> Zap up to char</h4>
<div class="outline-text-4" id="text-2-42-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">misc</span> <span style="color: #f78fe7;">:bind</span> ((<span style="color: #79a8ff;">"M-Z"</span> . zap-up-to-char)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a07080" class="outline-4">
<h4 id="org3a07080"><span class="section-number-4">2.42.6.</span> Transpose lines</h4>
<div class="outline-text-4" id="text-2-42-6">
<p>
From <a href="https://emacsredux.com/blog/2013/04/02/move-current-line-up-or-down/">https://emacsredux.com/blog/2013/04/02/move-current-line-up-or-down/</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/move-line-up</span> ()
  <span style="color: #9ac8e0;">"Move up the current line."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (transpose-lines 1)
  (forward-line -2)
  (indent-according-to-mode))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/move-line-down</span> ()
  <span style="color: #9ac8e0;">"Move down the current line."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (forward-line 1)
  (transpose-lines 1)
  (forward-line -1)
  (indent-according-to-mode))
(global-set-key (kbd <span style="color: #79a8ff;">"M-n"</span>) #'jdb/move-line-down)
(global-set-key (kbd <span style="color: #79a8ff;">"M-p"</span>) #'jdb/move-line-up)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org92b2205" class="outline-3">
<h3 id="org92b2205"><span class="section-number-3">2.43.</span> Legacy EXWM code</h3>
<div class="outline-text-3" id="text-2-43">
<p>
This code was useful when running with EXWM.
Perhaps it will be useful again.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #989898;">;; </span><span style="color: #989898;">Configure a logout function.</span>
(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">recentf</span>
  <span style="color: #f78fe7;">:commands</span> (jdb/exwm-logout recentf-save-list)
  <span style="color: #f78fe7;">:config</span>
  (<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/quit</span> ()
    <span style="color: #9ac8e0;">"Quit Emacs."</span>
    (<span style="color: #b6a0ff;">interactive</span>)
    (recentf-save-list)
    (save-some-buffers)
    (save-buffers-kill-emacs)))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/chr--switch-buffer-action</span> (buffer)
  <span style="color: #9ac8e0;">"Switch to a buffer named BUFFER if it is live.</span>
<span style="color: #9ac8e0;">If there is nota live buffer, and BUFFER looks an HTTP URL,</span>
<span style="color: #9ac8e0;">open it in a browser.</span>
<span style="color: #9ac8e0;">Otherwise, search for BUFFER with DuckDuckGo."</span>
  (<span style="color: #b6a0ff;">cond</span> ((buffer-live-p (get-buffer buffer)) (switch-to-buffer buffer 'force-same-window))
        <span style="color: #989898;">;; </span><span style="color: #989898;">Open URL from history.</span>
        ((string-match (<span style="color: #b6a0ff;">rx</span> string-start https-urlish <span style="color: #79a8ff;">" | "</span>) buffer) (jdb/chr current-prefix-arg (nth 0 (split-string buffer))))
        ((string-match (<span style="color: #b6a0ff;">rx</span> string-start https-urlish string-end) buffer) (jdb/chr current-prefix-arg buffer))
        (t (jdb/ddg current-prefix-arg (string-trim buffer)))))

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/chr--read-history</span> ()
  <span style="color: #9ac8e0;">"Read Chromium history file and add the URLs to ivy completion."</span>
  (<span style="color: #b6a0ff;">let*</span> ((wd <span style="color: #79a8ff;">"/home/jdb/.config/chromium/Default"</span>)
         (history-file (string-join (list wd <span style="color: #79a8ff;">"History"</span>) <span style="color: #79a8ff;">"/"</span>))
         (copy-file (concat history-file <span style="color: #79a8ff;">".copy"</span>)))
    <span style="color: #989898;">;; </span><span style="color: #989898;">Copy the file because Chromium keeps the database locked when running.</span>
    (copy-file history-file copy-file <span style="color: #79a8ff;">"overwrite-if-exists"</span>)
    (butlast (split-string (shell-command-to-string (format <span style="color: #79a8ff;">"sqlite3 %s -separator ' | ' 'SELECT url,title FROM urls'"</span> copy-file)) <span style="color: #79a8ff;">"\n"</span> nil))))

(<span style="color: #b6a0ff;">use-package</span> <span style="color: #00bcff;">s</span>)
(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">jdb/chr-read</span> ()
  <span style="color: #9ac8e0;">"Switch to a chromium process or start a new one.</span>
<span style="color: #9ac8e0;">INCOGNITO controls whether the window is opened incognito.</span>
<span style="color: #9ac8e0;">URL is the optional URL to open the process on."</span>
  (<span style="color: #b6a0ff;">interactive</span>)
  (ivy-read <span style="color: #79a8ff;">"Switch to buffer: "</span>
            #'(<span style="color: #b6a0ff;">lambda</span> (_ _ _) (append (internal-complete-buffer <span style="color: #79a8ff;">"Chromium-browser"</span> nil t) (jdb/chr--read-history)))
            <span style="color: #f78fe7;">:action</span> #'jdb/chr--switch-buffer-action
            <span style="color: #f78fe7;">:caller</span> 'jdb/chr-read))

(global-set-key (kbd <span style="color: #79a8ff;">"C-x c"</span>) 'jdb/chr-read)
<span style="color: #989898;">;; </span><span style="color: #989898;">C-x C-c is originally bound to save-buffers-kill-terminal which is a little too</span>
<span style="color: #989898;">;; </span><span style="color: #989898;">dangerous to have as a typo for jdb/chr-read.</span>
(global-unset-key (kbd <span style="color: #79a8ff;">"C-x C-c"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f64042" class="outline-3">
<h3 id="org1f64042"><span class="section-number-3">2.44.</span> Add footer for linting</h3>
<div class="outline-text-3" id="text-2-44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #b6a0ff;">provide</span> '<span style="color: #00bcff;">emacs</span>)
<span style="color: #989898;">;;; </span><span style="color: #989898;">init.el ends here</span>
</pre>
</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://orgmode.org/manual/Creating-Footnotes.html">https://orgmode.org/manual/Creating-Footnotes.html</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://blog.d46.us/advanced-emacs-startup/">https://blog.d46.us/advanced-emacs-startup/</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Jack Baldry</p>
<p class="date">Created: 2023-03-21 Tue 14:00</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>